{"version":3,"file":"UNSAFE_ExpandableList.js","sources":["../../src/UNSAFE_ExpandableList/useExpandCollapse.ts","../../src/UNSAFE_ExpandableList/ExpandableList.tsx"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\nimport { useCallback } from 'preact/hooks';\nimport { ToggleDetail } from '../UNSAFE_Collection';\nimport { useUser } from '../hooks/UNSAFE_useUser';\nimport { containsKey, Keys } from '../utils/UNSAFE_keys';\n\n/**\n * A hook that handles mouse and keyboard gesture that toggles the expanded state.\n * @param keyExtractor\n * @param expanded\n * @param onToggle\n * @returns\n */\nexport function useExpandCollapse<K>(\n  keyExtractor: (element: HTMLElement) => K | null,\n  expanded: Keys<K>,\n  onToggle?: (detail: ToggleDetail<K>) => void\n) {\n  const { direction } = useUser();\n  const isRtl = direction === 'rtl';\n\n  const onClick = useCallback(\n    (event: MouseEvent) => {\n      handleToggle(event, keyExtractor, onToggle);\n    },\n    [keyExtractor, onToggle]\n  );\n\n  const onKeyUp = useCallback(\n    (event: KeyboardEvent) => {\n      if (event.key === 'Enter' || event.key === ' ') {\n        handleToggle(event, keyExtractor, onToggle);\n      } else if (event.key === 'ArrowLeft' || event.key === 'ArrowRight') {\n        const isLeftArrow = event.key === 'ArrowLeft' && !isRtl;\n        handleArrowKey(isLeftArrow, event.target as HTMLElement, expanded, keyExtractor, onToggle);\n        // arrow key might cause it to scroll horizontally\n        event.preventDefault();\n        event.stopPropagation();\n      }\n    },\n    [keyExtractor, onToggle]\n  );\n\n  return onToggle ? { onClick, onKeyDown, onKeyUp } : {};\n}\n\n// prevent default (propagation) for keyDown to prevent scrolling the container\nconst onKeyDown = (event: KeyboardEvent) => {\n  if (event.key === 'Enter' || event.key === 'ArrowLeft' || event.key === 'ArrowRight') {\n    event.preventDefault();\n  }\n};\n\nconst handleArrowKey = <K>(\n  isLeftArrow: boolean,\n  target: HTMLElement,\n  expanded: Keys<K>,\n  keyExtractor: (element: HTMLElement) => K | null,\n  onToggle?: (detail: ToggleDetail<K>) => void\n) => {\n  const itemKey = keyExtractor(target);\n  if (onToggle && itemKey) {\n    const contains = containsKey(expanded, itemKey);\n    if ((isLeftArrow && contains) || (!isLeftArrow && !contains)) {\n      onToggle({ value: itemKey });\n    }\n  }\n};\n\nconst handleToggle = <K>(\n  event: Event,\n  keyExtractor: (element: HTMLElement) => K | null,\n  onToggle?: (detail: ToggleDetail<K>) => void\n) => {\n  const itemKey = keyExtractor(event.target as HTMLElement);\n  if (onToggle && itemKey) {\n    onToggle({ value: itemKey });\n    if (event.type === 'click') {\n      event.stopPropagation();\n    }\n  }\n};\n","import { ComponentChildren, Fragment } from 'preact';\nimport { useState, useMemo, useCallback } from 'preact/hooks';\nimport { memo } from 'preact/compat';\nimport { cssProps } from '@oracle/oraclejet-cssprops';\nimport { classNames } from '../utils/UNSAFE_classNames';\nimport {\n  HierarchicalItemContext,\n  ListItemContext,\n  SelectionDetail,\n  ToggleDetail,\n  FlattenedDataState\n} from '../UNSAFE_Collection';\nimport { useId } from '../hooks/UNSAFE_useId';\nimport { useTranslationBundle } from '../hooks/UNSAFE_useTranslationBundle';\nimport type { BundleType } from '../resources/nls/bundle';\nimport { Keys, containsKey, isSameKey } from '../utils/UNSAFE_keys';\nimport { Button } from '../UNSAFE_Button';\nimport { HiddenAccessible } from '../UNSAFE_HiddenAccessible';\nimport { ExpandIcon } from '../PRIVATE_ThemedIcons/ExpandIcon';\nimport { CollapseIcon } from '../PRIVATE_ThemedIcons/CollapseIcon';\nimport {\n  List,\n  ListGroupHeader,\n  GROUP_SELECTOR,\n  excludeGroup,\n  GroupLoadingIndicator\n} from '../PRIVATE_List';\nimport { LiveRegion } from '../UNSAFE_LiveRegion';\nimport { CustomRendererContext, PublicListProps } from '../UNSAFE_ListView/List.types';\nimport { useExpandCollapse } from './useExpandCollapse';\nimport { keyExtractor } from '../utils/PRIVATE_collectionUtils';\n\n// these are the props that are different from ListView\ntype SpecificTypes<K, D> = {\n  /**\n   * A function to render an item or a group header.\n   */\n  children: (context: HierarchicalItemContext<K, D>) => ComponentChildren;\n  /**\n   * A FlattenedDataState object that provides information including data and metadata to this ExpandableList.\n   * If the value is null, then ExpandableList will show loading indicator until a FlattenedDataState is set.\n   */\n  data: FlattenedDataState<K, D> | null;\n  /**\n   * A function to handle when user performs a gesture that toggles the expansion state of a group header\n   */\n  onToggle?: (detail: ToggleDetail<K>) => void;\n};\n\n/**\n * Props for the ExpandableList Component, which consist of all props from ListView\n * except some which have different signatures.\n */\ntype ExpandableListProps<K, D> = Omit<PublicListProps<K, D>, 'children' | 'data'> &\n  SpecificTypes<K, D>;\n\n/**\n * An ExpandableList shows a two-level group of items where each group header can be expand or collapse.\n */\nexport function ExpandableList<K extends string | number, D>({\n  children,\n  currentKey,\n  data,\n  onSelectionChange,\n  onToggle,\n  ...props\n}: ExpandableListProps<K, D>) {\n  const [statusText, setStatusText] = useState('');\n  const translations = useTranslationBundle<BundleType>('@oracle/oraclejet-preact');\n\n  const expandCollapseProps = useExpandCollapse(\n    (element: HTMLElement) => {\n      if (element.getAttribute('role') === 'treegrid') {\n        return currentKey === undefined ? null : currentKey;\n      }\n      return keyExtractor(element, GROUP_SELECTOR) as K;\n    },\n    data == null ? (emptyKeys as Keys<K>) : data.expanded,\n    onToggle\n      ? useCallback(\n          (detail: ToggleDetail<K>) => {\n            onToggle(detail);\n            if (data) {\n              const previouslyExpanded = containsKey(data?.expanded, detail.value);\n              setStatusText(\n                previouslyExpanded\n                  ? translations.expandableList_groupCollapse()\n                  : translations.expandableList_groupExpand()\n              );\n              // we need to clear the live region text otherwise screenreader\n              // won't read again if the content did not change the next time\n              setTimeout(() => {\n                setStatusText('');\n              }, 1000);\n            }\n          },\n          [onToggle, data]\n        )\n      : undefined\n  );\n\n  const descId = useId();\n  const stableDescId = useMemo(() => {\n    // this should never change after mounted\n    return descId;\n  }, []);\n\n  const createHierarchicalContext = <K, D>(\n    context: ListItemContext<K, D>,\n    options?: { expanded: boolean; onToggle: (detail: ToggleDetail<K>) => void }\n  ) => {\n    const expanderRenderer =\n      options !== undefined\n        ? () => (\n            <Expander\n              itemKey={context.metadata.key}\n              expanded={options.expanded}\n              onToggle={options.onToggle}\n            />\n          )\n        : undefined;\n\n    return {\n      ...context,\n      parentKey: context.metadata.parentKey,\n      leaf: context.metadata.isLeaf ?? true,\n      depth: context.metadata.treeDepth ?? 1,\n      expander: expanderRenderer\n    };\n  };\n\n  const handleSelectionChange = useCallback(\n    (detail: SelectionDetail<K>) => {\n      if (onSelectionChange && data) {\n        const keys = excludeGroup(data, detail.value);\n        if (isSameKey(keys, detail.value)) {\n          onSelectionChange(detail);\n        } else if (keys.keys && keys.keys.size > 0) {\n          onSelectionChange({ ...detail, value: keys });\n        }\n      }\n    },\n    [onSelectionChange, data]\n  );\n\n  const customItemRenderer = (context: CustomRendererContext<K, D>) => {\n    const itemKey = context.listItemContext.metadata.key;\n    const options =\n      data && onToggle ? { expanded: containsKey(data.expanded, itemKey), onToggle } : undefined;\n    const itemContext = createHierarchicalContext(context.listItemContext, options);\n    if (itemContext.leaf) {\n      return context.defaultListItem(itemContext, { itemDepth: itemContext.depth + 1 });\n    } else {\n      return (\n        <ListGroupHeader\n          key={itemContext.metadata.key}\n          ariaDescribedBy={stableDescId}\n          itemKey={itemContext.metadata.key}\n          itemIndex={itemContext.index}\n          itemDepth={itemContext.depth}\n          isFocused={context.isFocused}\n          isFocusRingVisible={context.isFocusRingVisible}\n          isActive={context.isActive}\n          isGridlineVisible={false}\n          isExpandable={true}\n          expandedKeys={data == null ? (emptyKeys as Keys<K>) : data.expanded}\n          onToggle={onToggle}>\n          {children(itemContext)}\n        </ListGroupHeader>\n      );\n    }\n  };\n\n  return (\n    <Fragment>\n      <List\n        isVirtualized={false}\n        currentKey={currentKey}\n        data={data}\n        role=\"treegrid\"\n        loadingIndicator={<GroupLoadingIndicator />}\n        onSelectionChange={handleSelectionChange}\n        customItemRenderer={customItemRenderer}\n        eventHandlers={expandCollapseProps}\n        {...props}>\n        {(context: ListItemContext<K, D>) => {\n          return children(context as HierarchicalItemContext<K, D>);\n        }}\n      </List>\n      {onToggle && (\n        <Fragment>\n          <LiveRegion>{statusText}</LiveRegion>\n          <span id={stableDescId}>\n            <HiddenAccessible>\n              {translations.expandableList_expandCollapseInstructionText()}\n            </HiddenAccessible>\n          </span>\n        </Fragment>\n      )}\n    </Fragment>\n  );\n}\n\nconst emptyKeys = { all: false, keys: new Set() };\n\nconst Expander = memo(\n  <K,>(props: { itemKey: K; expanded: boolean; onToggle: (detail: ToggleDetail<K>) => void }) => {\n    const styles = {\n      base: cssProps`${{\n        margin: '0 calc(1.25 * var(--oj-c-PRIVATE-DO-NOT-USE-core-spacing-1x))'\n      }}`\n    };\n\n    const classes = classNames([styles.base, 'oj-listview-expander']);\n\n    const actionHandler = () => {\n      props.onToggle({ value: props.itemKey });\n    };\n\n    return (\n      <span class={classes} role=\"presentation\">\n        <Button\n          onAction={actionHandler}\n          variant=\"ghost\"\n          startIcon={props.expanded ? <ExpandIcon size=\"6x\" /> : <CollapseIcon size=\"6x\" />}\n        />\n      </span>\n    );\n  },\n  (prev: any, next: any) => {\n    return (\n      prev.itemKey === next.itemKey &&\n      prev.expanded === next.expanded &&\n      prev.onToggle === next.onToggle\n    );\n  }\n);\n"],"names":["onKeyDown","event","key","preventDefault","handleArrowKey","isLeftArrow","target","expanded","keyExtractor","onToggle","itemKey","contains","containsKey","value","handleToggle","type","stopPropagation","emptyKeys","all","keys","Set","Expander","memo","props","classes","classNames","prev","next","children","currentKey","data","onSelectionChange","translations","useTranslationBundle","expandCollapseProps","direction","useUser","isRtl","onClick","useCallback","onKeyUp","useExpandCollapse","element","GROUP_SELECTOR","detail","previouslyExpanded","setStatusText","expandableList_groupCollapse","expandableList_groupExpand","descId","useId","stableDescId","useMemo","handleSelectionChange","context","createHierarchicalContext","options","expanderRenderer","undefined","_jsx","metadata","parentKey","leaf","isLeaf","depth","treeDepth","expander","defaultListItem","itemContext","itemDepth","ListGroupHeader","ariaDescribedBy","itemIndex","index","isFocused","isFocusRingVisible","isActive","isGridlineVisible","isExpandable","expandedKeys","_jsxs","jsxs","Fragment","jsx","LiveRegion","statusText","id","HiddenAccessible","expandableList_expandCollapseInstructionText"],"mappings":"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"}