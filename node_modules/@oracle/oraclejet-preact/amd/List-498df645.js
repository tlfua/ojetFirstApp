define(['exports', 'preact/jsx-runtime', 'preact/hooks', './utils/UNSAFE_classNames', './utils/UNSAFE_mergeProps', './utils/UNSAFE_keys', './PRIVATE_LoadMoreCollection', './PRIVATE_VirtualizedCollection', 'preact/compat', './hooks/UNSAFE_useTabbableMode', './UNSAFE_FocusTrap', './hooks/UNSAFE_useId', './hooks/UNSAFE_useInteractionStyle', './utils/UNSAFE_mergeInterpolations', './utils/UNSAFE_interpolations/flexitem', './PRIVATE_List/themes/ListStyles.css', './classNames-711dac8e', './flexitem-391ab989', './FocusTrap-84b5ca93', './hooks/PRIVATE_useSelection', './hooks/PRIVATE_useCurrentKey', './hooks/PRIVATE_useCollectionFocusRing', './hooks/PRIVATE_useTabbableModeSet', './hooks/PRIVATE_useItemAction', './SkeletonContainer-ef2d239d', './UNSAFE_Skeleton', './UNSAFE_Flex', './utils/PRIVATE_collectionUtils', './UNSAFE_Selector', './hooks/PRIVATE_useCollectionGestureContext', './VirtualizedCollection-52339bba', './LoadMoreCollection-0f3a3fa8', './Flex-cd926f6b', './Skeleton-6e2d8eba'], (function(e,t,i,s,o,n,l,a,r,c,u,d,f,g,m,b,y,S,v,x,p,h,k,A,E,C,I,F,T,V,R,P,j,w){"use strict";const _=e=>{switch(e){case"listbox":return{list:"listbox",item:"presentation",cell:"option"};case"treegrid":return{list:"treegrid",item:"row",cell:"gridcell"};default:return{list:"grid",item:"row",cell:"gridcell"}}},N="oj-c-listview-item",K="."+N;function M({children:e,itemKey:s,itemIndex:o,itemDepth:n,isFocused:l,isFocusRingVisible:a,isActive:r,isGridlineVisible:u,isSelected:m,isTopGridlineVisible:x=!1,isTabbable:p=!1,role:h,selectionMode:k,suggestion:A,currentItemVariant:E}){const C=i.useRef(null),I=i.useMemo((()=>_(h)),[h]),F="option"===I.cell?{role:I.cell,"aria-posinset":o+1,"aria-setsize":-1}:{role:I.cell},{interactionProps:T,applyActiveStyle:V,applyHoverStyle:R,applyPseudoHoverStyle:P}=f.useInteractionStyle(),j=b.listItemMultiVariantStyles({selectable:L(k,m)?"isSelectable":"notSelectable",selected:m?"isSelected":"notSelected",selectedSingle:m&&"single"===k?"isSelectedSingle":"notSelectedSingle",needsEventsHover:R?"isNeedsEventsHover":"notNeedsEventsHover",pseudoHover:P?"isPseudoHover":"notPseudoHover",active:V||r?"isActive":"notActive",focusHighlight:"highlight"===E&&l?"isFocusHighlight":"notFocusHighlight",focusRingVisible:a&&l?"isFocusRingVisible":"notFocusRingVisible",gridlineTop:x?"visible":"hidden",gridlineBottom:!u&&("end"!==A||u||m&&"single"===k)?"hidden":"visible"}),w=y.classNames([N,j]),K=g.mergeInterpolations([...Object.values(S.flexitemInterpolations)]),{class:M,...z}=K({flex:"1 1 auto",alignSelf:"center"}),H=y.classNames([M,"multiple"===k&&b.listItemStyles.checkboxContainer]);return t.jsx("div",{"aria-rowindex":o+1,"aria-level":n,"data-oj-key":s,class:w,ref:C,role:I.item,...A&&{"data-oj-suggestion":!0},..."number"==typeof s&&{"data-oj-key-type":"number"},...T,children:t.jsx("div",{id:d.useId(),style:z,class:H,"aria-posinset":o+1,"aria-setsize":-1,onKeyDown:e=>{!p||"ArrowDown"!==e.key&&"ArrowUp"!==e.key||e.stopPropagation()},"aria-colindex":1,"aria-selected":"none"!==k?m:void 0,...F,children:t.jsx(c.TabbableModeContext.Provider,{value:{isTabbable:p},children:t.jsx(v.FocusTrap,{isDisabled:!p,restoreFocusRef:!1,children:e})})})})}const L=(e,t)=>"none"!==e&&("multiple"===e||!t),z=r.memo(M,((e,t)=>!(!e||!t)&&(e.itemKey===t.itemKey&&e.itemIndex===t.itemIndex&&e.itemData===t.itemData&&e.isFocused===t.isFocused&&e.isFocusRingVisible===t.isFocusRingVisible&&e.isSelected===t.isSelected&&e.isTabbable===t.isTabbable&&e.isActive===t.isActive&&e.suggestion===t.suggestion)));const H="oj-collection-sparkle";function U({sparkleHeight:e}){if(e<=0)return null;const i=e+"px",s=y.classNames([b.sparkleStyles.base]),o=y.classNames([b.sparkleStyles.container,H]);return t.jsx("div",{class:o,children:t.jsx("div",{class:s,style:{height:i}})},"sparkle")}const D=e=>!(!e.parentElement||!e.parentElement.classList.contains("oj-listview-expander")),O=(e,t,i)=>{if(e&&t&&(e.scrollIntoViewIfNeeded?e.scrollIntoViewIfNeeded():e.scrollIntoView({block:"nearest"}),i>0)){const s=t.getBoundingClientRect(),o=e.getBoundingClientRect(),n=s.top+i-o.top;n>0&&(t.scrollTop=t.scrollTop-n)}},G=(e,t)=>t??{scroller:()=>e.current},B={all:!1,keys:new Set},q=(e,t)=>{const i=t.data.map((e=>e.metadata.key)),s=i.indexOf(e.value.start),o=i.indexOf(e.value.end),n=Math.min(s,o),l=Math.max(s,o);return-1===n?{offset:0,count:t.totalSize}:i.slice(n,l+1)},Y=t.jsx(E.SkeletonContainer,{minimumCount:25,children:()=>t.jsx(j.Flex,{height:"12x",align:"center",children:t.jsx(w.Skeleton,{height:"4x"})})}),$=t.jsx("div",{class:P.LOADMORE_STYLE_CLASS,children:t.jsx(E.SkeletonContainer,{minimumCount:3,children:()=>t.jsx(j.Flex,{height:"12x",align:"center",children:t.jsx(w.Skeleton,{height:"4x"})})})}),J=(e,t)=>{if(t){const i=Math.min(t.offset,e.offset+e.totalSize),s=i-e.offset;s>0&&(e={offset:i,data:e.data.slice(s,s+t.count),totalSize:e.totalSize,sizePrecision:e.sizePrecision})}return e};e.ITEM_STYLE_CLASS=N,e.List=function({"aria-label":e,"aria-labelledby":s,allowTabbableMode:l=!0,children:a,currentKey:r,data:c,gridlines:u,loadingIndicator:d=Y,onCurrentKeyChange:f,onLoadRange:g,onSelectionChange:m,onItemAction:S,rangeExtractor:v,role:E="grid",selectedKeys:C=B,selectionMode:I="none",viewportConfig:j,currentItemVariant:w="none",promotedSection:N,isVirtualized:L=!0,customItemRenderer:H,eventHandlers:Q,scrollToVisibleOffset:W}){const X=i.useRef(null),Z=i.useMemo((()=>_(E)),[E]),ee=i.useRef(),te=i.useRef(),ie=i.useRef(),[se,oe]=i.useState(!1),[ne,le]=i.useState(0),ae="none"===I?void 0:"multiple"===I,re=null===c?void 0:"exact"===c.sizePrecision?c.totalSize:-1,ce=y.classNames([b.listStyles.base]);!function(e,t,s){const o=i.useRef();i.useEffect((()=>{const i=o.current;if(t&&s&&i&&e&&i.offset===e.offset&&i!==e){const o=e.data.map((e=>e.metadata.key));if(-1===o.indexOf(t)){const e=i?.data.map((e=>e.metadata.key));let n=e.indexOf(t);if(n>-1){const t=n===e.length-1;for(;n>=0&&n<e.length;){n=t?n-1:n+1;const i=e[n];if(o.indexOf(i)>-1){s({value:i});break}}}}}o.current=e}),[e,t,s])}(c,r,f);const{currentKeyProps:ue}=p.useCurrentKey((e=>F.keyExtractor(e,K)),"multiple"!==I,F.getPrevNextKey(X.current,r,!0,K),F.getPrevNextKey(X.current,r,!1,K),void 0,void 0,r,f),de=e=>!!X.current?.contains(e),[fe,ge]=h.useCollectionFocusRing(de,["ArrowUp","ArrowDown"]);let me=!1;const[be,ye]=k.useTabbableModeSet(de,(e=>D(e)?null:F.keyExtractor(e,K)),r,((e,t)=>{de(e)&&(t?(me=!0,setTimeout((()=>{X.current?.focus()}),0)):X.current?.focus())}),(e=>{f&&f({value:e})}));i.useEffect((()=>{if(null!=r&&X.current){const e=F.findElementByKey(X.current,r,K);if(e){const t=X.current.getAttribute("aria-activedescendant"),i=e.querySelector(`[role=${Z.cell}]`);if(i&&t!==i.id){X.current.setAttribute("aria-activedescendant",i.id);const t=j?.scroller(),s=W?W(X.current):0;O(e,null!=t?t:X.current,s)}}}}),[r,c,Z.cell,j]);const Se=i.useCallback((e=>{m&&(!1===e.value.all&&e.value.keys.size>0&&(ee.current=Array.from(e.value.keys.values()).pop()),m(e))}),[ee,m]),ve=i.useCallback((e=>{if(c&&m){const t=q(e,c);Array.isArray(t)?m({value:{all:!1,keys:new Set(t)},target:null}):(te.current={detail:e,range:{offset:c.offset,count:c.data.length}},g(t))}}),[c,m,g]),xe=i.useCallback((()=>{if(X.current&&f&&(!l||be(void 0))){const e=ie.current||F.getFirstVisibleKey(X.current,K);n.isKeyDefined(e)&&f({value:e})}}),[l,f,be]),pe=i.useCallback((e=>{const t=F.keyExtractor(e.target,K);t&&"checkbox"===e.relatedTarget?.getAttribute("type")&&(X.current?.focus(),f&&t&&f({value:t}))}),[f]),he=i.useCallback((e=>{if(D(e.target)){X.current?.focus();const t=F.keyExtractor(e.target,K);f&&t&&f({value:t})}else!n.isKeyDefined(r)&&f&&xe(),!l&&pe(e)}),[l,r,xe,pe,f]),ke=V.useCollectionGestureContext(),{selectionProps:Ae}=x.useSelection((e=>e===X.current?void 0===r?null:r:F.keyExtractor(e,K)),C,I,!1,"replace","embedded"===ke,Se,ee.current,r,((e,t)=>F.getPrevNextKey(X.current,e,t,K)),void 0,(e=>{if(X.current){const t=F.findElementByKey(X.current,e,K);if(t){const e=j?.scroller(),i=W?W(X.current):0;O(t,null!=e?e:X.current,i)}}}),ve);if(c&&void 0!==te.current&&m){const e=q(te.current.detail,c);Array.isArray(e)&&m({value:{all:!1,keys:new Set(e)},target:null});const t=te.current?te.current.range:{offset:c.offset,count:c.data.length};c=J(c,t),te.current=void 0,g(t)}const Ee=i.useMemo((()=>c&&N&&((e,t)=>0===t?null:e.slice(0,t).reduce(((e,i,s)=>{const o=i.metadata.key;return s===t-1?e.set(o,"end"):e.set(o,!0),e}),new Map))(c.data,N.count)),[c,N]),Ce=t.jsx(U,{sparkleHeight:ne}),Ie=A.useItemAction(r,c,S,K,"embedded"===ke);i.useEffect((()=>{if(Ee){const e=X.current?.querySelector("."+R.PLACEHOLDER_STYLE_CLASS);let t=e?.offsetHeight||0;const i=X.current?.querySelectorAll("[data-oj-suggestion]");i?.forEach((e=>t+=e.offsetHeight)),le(t)}}),[Ee]);const Fe=i.useCallback((e=>{const i="multiple"===I?()=>t.jsx(T.Selector,{onChange:Se,rowKey:e.data.metadata.key,selectedKeys:C}):void 0;return{index:e.index,data:e.data.data,metadata:e.data.metadata,selector:i}}),[I,C,Se]),Te=L?M:z,Ve=e=>{const i=Fe(e),s=Ee?.get(i.metadata.key),o=l&&be(i.metadata.key),d=r===i.metadata.key&&!o,f=d&&se,g=n.containsKey(C,i.metadata.key),m=d&&fe&&!me,b=(e,o)=>{return t.jsx(Te,{isFocused:d,isFocusRingVisible:m,isActive:f,isGridlineVisible:(n=i.index,"visible"===u?.item&&(n+1!==c?.totalSize||"visible"===u?.bottom)),isSelected:g,isTabbable:l&&be(i.metadata.key),itemIndex:i.index,itemKey:i.metadata.key,itemData:i.data,role:E,selectionMode:I,currentItemVariant:w,...s&&{suggestion:s},...0===i.index&&{isTopGridlineVisible:"visible"===u?.item&&"visible"===u?.top},...o,children:a(e)},i.metadata.key);var n};if(H){return H({listItemContext:i,isFocused:d,isFocusRingVisible:m,isSelected:g,isTabbable:o,isActive:f,defaultListItem:b})}return b(i)};j=G(X,j);const Re=i.useCallback((e=>{const t=F.keyExtractor(e.target,K);n.isKeyDefined(t)&&(ie.current=t)}),[]),Pe=i.useCallback((e=>{" "===e.key&&r&&"none"!==I&&oe(!0)}),[r,I,oe]),je=i.useCallback((()=>{oe(!1)}),[oe]);return t.jsx("div",{...o.mergeProps(l?ye:{},ue,ge,Ae,Ie,{onFocus:he,onPointerDown:Re,onKeyDown:Pe,onKeyUp:je},void 0!==Q?Q:{}),role:E,"aria-rowcount":re,"aria-colcount":1,ref:X,class:ce,tabIndex:0,"aria-label":e,"aria-labelledby":s,"aria-multiselectable":ae,children:null==c?d:L?t.jsx(R.VirtualizedCollection,{data:c,itemSelector:K,loadMoreIndicator:$,onLoadRange:g,rangeExtractor:v,suggestions:Ce,viewportConfig:j,children:Ve}):t.jsx(P.LoadMoreCollection,{data:c.data,loadMoreIndicator:$,hasMore:"atLeast"===c.sizePrecision&&c.data.length<=c.totalSize,onLoadMore:()=>{c&&g({offset:0,count:c.data.length+25})},suggestions:Ce,viewportConfig:j,children:Ve})})}}));
//# sourceMappingURL=List-498df645.js.map
