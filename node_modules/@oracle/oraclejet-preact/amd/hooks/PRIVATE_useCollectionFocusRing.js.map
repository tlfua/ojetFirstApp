{"version":3,"file":"PRIVATE_useCollectionFocusRing.js","sources":["../../../src/hooks/PRIVATE_useCollectionFocusRing/useCollectionFocusRing.ts"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\nimport { useCallback, useState, useRef } from 'preact/hooks';\n\n/**\n * Hook for handling focus ring management in Collection components.\n *\n * @param contains function that returns true if the Collection contains the specified element.\n * @param navigationKeys set of keys that are considered as navigation keys for Collection.\n * @param isVisibleFocusLostOnClick boolean or function that returns a boolean that states if focus is going to be visible after a click\n * @returns\n */\nexport function useCollectionFocusRing(\n  contains: (elem: Element | null) => boolean,\n  navigationKeys: string[],\n  isVisibleFocusLostOnClick: ((elem: Element) => boolean) | boolean = true\n): [\n  boolean,\n  {\n    onFocus: (event: FocusEvent) => void;\n    onBlur: (event: FocusEvent) => void;\n    onKeyDown: (event: KeyboardEvent) => void;\n    onPointerDown: (event: PointerEvent) => void;\n  }\n] {\n  const [focusRingVisible, setFocusRingVisible] = useState(false);\n\n  const recentPointerRef = useRef(false);\n\n  const blurDoneBecauseTabChangeRef = useRef(false);\n\n  // We need to clear this out when using touching devices\n  // TODO: We need to confirm if this type is correct or has to be changed\n  const pointerDownTimerRef = useRef<ReturnType<typeof setTimeout>>();\n\n  const onFocus = useCallback(() => {\n    if (\n      !focusRingVisible &&\n      recentPointerRef.current === false &&\n      !blurDoneBecauseTabChangeRef.current\n    ) {\n      setFocusRingVisible(true);\n    }\n    blurDoneBecauseTabChangeRef.current = false;\n  }, [focusRingVisible]);\n\n  const onBlur = useCallback(\n    (e: FocusEvent) => {\n      /* Between leaving the old element and entering the new element the active element \n      is the document/body itself. This is not the case when blur is produced when changing tab.\n      In this last case the document.active element is the same as the target of the blur method.*/\n      if (e.target === document.activeElement) {\n        blurDoneBecauseTabChangeRef.current = true;\n      }\n\n      setTimeout(() => {\n        if (focusRingVisible && !contains(document.activeElement)) {\n          // remove focus ring\n          setFocusRingVisible(false);\n        }\n      }, FOCUS_SHIFT_TIMEOUT);\n    },\n    [focusRingVisible, contains]\n  );\n\n  const onPointerDown = useCallback(\n    (e: PointerEvent) => {\n      const getIsVisibleFocusLostOnClick =\n        typeof isVisibleFocusLostOnClick === 'function'\n          ? isVisibleFocusLostOnClick(e.target as Element)\n          : isVisibleFocusLostOnClick;\n\n      if (focusRingVisible && getIsVisibleFocusLostOnClick) {\n        setFocusRingVisible(false);\n      }\n      recentPointerRef.current = true;\n      pointerDownTimerRef.current = setTimeout(() => {\n        recentPointerRef.current = false;\n      }, FOCUS_SHIFT_TIMEOUT);\n    },\n    [focusRingVisible, isVisibleFocusLostOnClick]\n  );\n\n  //onFocus is called after pointerDown on desktop devices, but for touch ones focus is triggered after touch end\n  const onTouchEnd = useCallback(() => {\n    clearTimeout(pointerDownTimerRef.current);\n    recentPointerRef.current = true;\n    setTimeout(() => {\n      recentPointerRef.current = false;\n    }, FOCUS_SHIFT_TIMEOUT);\n  }, []);\n\n  const onKeyDown = useCallback(\n    (event: KeyboardEvent) => {\n      if (navigationKeys.indexOf(event.key) > -1) {\n        if (!focusRingVisible) {\n          setFocusRingVisible(true);\n        }\n      }\n    },\n    [focusRingVisible, navigationKeys]\n  );\n\n  const focusRingProps = { onFocus, onBlur, onPointerDown, onKeyDown, onTouchEnd };\n  return [focusRingVisible, focusRingProps];\n}\n\nconst FOCUS_SHIFT_TIMEOUT = 200;\n"],"names":["FOCUS_SHIFT_TIMEOUT","contains","navigationKeys","isVisibleFocusLostOnClick","focusRingVisible","setFocusRingVisible","useState","recentPointerRef","useRef","blurDoneBecauseTabChangeRef","pointerDownTimerRef","onFocus","useCallback","current","onBlur","e","target","document","activeElement","setTimeout","onPointerDown","getIsVisibleFocusLostOnClick","onTouchEnd","clearTimeout","onKeyDown","event","indexOf","key"],"mappings":"8DAgHA,MAAMA,EAAsB,6BA/FtB,SACJC,EACAC,EACAC,GAAoE,GAUpE,MAAOC,EAAkBC,GAAuBC,EAAQA,UAAC,GAEnDC,EAAmBC,UAAO,GAE1BC,EAA8BD,UAAO,GAIrCE,EAAsBF,EAAAA,SAEtBG,EAAUC,EAAAA,aAAY,KAEvBR,IAC4B,IAA7BG,EAAiBM,SAChBJ,EAA4BI,SAE7BR,GAAoB,GAEtBI,EAA4BI,SAAU,CAAK,GAC1C,CAACT,IAEEU,EAASF,eACZG,IAIKA,EAAEC,SAAWC,SAASC,gBACxBT,EAA4BI,SAAU,GAGxCM,YAAW,KACLf,IAAqBH,EAASgB,SAASC,gBAEzCb,GAAoB,EACrB,GACAL,EAAoB,GAEzB,CAACI,EAAkBH,IAGfmB,EAAgBR,eACnBG,IACC,MAAMM,EACiC,mBAA9BlB,EACHA,EAA0BY,EAAEC,QAC5Bb,EAEFC,GAAoBiB,GACtBhB,GAAoB,GAEtBE,EAAiBM,SAAU,EAC3BH,EAAoBG,QAAUM,YAAW,KACvCZ,EAAiBM,SAAU,CAAK,GAC/Bb,EAAoB,GAEzB,CAACI,EAAkBD,IAIfmB,EAAaV,EAAAA,aAAY,KAC7BW,aAAab,EAAoBG,SACjCN,EAAiBM,SAAU,EAC3BM,YAAW,KACTZ,EAAiBM,SAAU,CAAK,GAC/Bb,EAAoB,GACtB,IAEGwB,EAAYZ,eACfa,IACKvB,EAAewB,QAAQD,EAAME,MAAQ,IAClCvB,GACHC,GAAoB,GAEvB,GAEH,CAACD,EAAkBF,IAIrB,MAAO,CAACE,EADe,CAAEO,UAASG,SAAQM,gBAAeI,YAAWF,cAEtE"}