/* @oracle/oraclejet-preact: 15.1.2 */
'use strict';

var jsxRuntime = require('preact/jsx-runtime');
var preact = require('@testing-library/preact');
var chai = require('chai');
var testHelpers = require('./testHelpers-fa250c78.js');
var listViewTestFixtures = require('./listViewTestFixtures-6e1e4f91.js');
var userEvent = require('@testing-library/user-event');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var userEvent__default = /*#__PURE__*/_interopDefaultLegacy(userEvent);

const testTabbableMode = (TestComponent) => {
    it('acts as single tab stop in composition', async () => {
        const data = listViewTestFixtures.populateData(100, true);
        const dataMetadata = data.map((data) => {
            return { data: data, metadata: { key: data.id } };
        });
        const list = preact.render(jsxRuntime.jsx(TestComponent, { data: dataMetadata }));
        const grid = await testHelpers.getRoot(list);
        await userEvent__default["default"].tab();
        chai.expect(document.activeElement).equals(list.getByText('Preceding Button'));
        await userEvent__default["default"].tab();
        chai.expect(document.activeElement).equals(grid);
        await userEvent__default["default"].tab();
        chai.expect(document.activeElement).equals(list.getByText('Following Button'));
        await userEvent__default["default"].tab({ shift: true });
        chai.expect(document.activeElement).equals(grid);
        await userEvent__default["default"].tab({ shift: true });
        chai.expect(document.activeElement).equals(list.getByText('Preceding Button'));
    });
    it('enters interactive mode with keyboard via F2', async () => {
        const data = listViewTestFixtures.populateData(100, true);
        const dataMetadata = data.map((data) => {
            return { data: data, metadata: { key: data.id } };
        });
        const list = preact.render(jsxRuntime.jsx(TestComponent, { data: dataMetadata }));
        const grid = await testHelpers.getRoot(list);
        // Tab past first button into ListView
        await userEvent__default["default"].tab();
        await userEvent__default["default"].tab();
        chai.expect(document.activeElement).equals(grid);
        list.rerender(jsxRuntime.jsx(TestComponent, { data: dataMetadata }));
        const firstRowInput = list.getByTestId('input-0');
        chai.expect(firstRowInput.getAttribute('tabindex')).equals('-1');
        preact.fireEvent.keyDown(grid, { key: 'F2' });
        chai.expect(firstRowInput.getAttribute('tabindex')).equals('0');
    });
    it('leaves interactive mode with keyboard via ESC', async () => {
        const data = listViewTestFixtures.populateData(100, true);
        const dataMetadata = data.map((data) => {
            return { data: data, metadata: { key: data.id } };
        });
        const list = preact.render(jsxRuntime.jsx(TestComponent, { data: dataMetadata }));
        const grid = await testHelpers.getRoot(list);
        const firstRowInput = list.getByTestId('input-0');
        chai.expect(firstRowInput.getAttribute('tabindex')).equals('-1');
        await userEvent__default["default"].click(firstRowInput);
        chai.expect(firstRowInput.getAttribute('tabindex')).equals('0');
        preact.fireEvent.keyDown(firstRowInput, { key: 'Escape' });
        await preact.waitFor(() => {
            chai.expect(document.activeElement, 'active element should be grid').equals(grid);
        });
    });
    it('enters interactive mode again with keyboard via arrow keys and F2', async () => {
        const data = listViewTestFixtures.populateData(100, true);
        const dataMetadata = data.map((data) => {
            return { data: data, metadata: { key: data.id } };
        });
        const list = preact.render(jsxRuntime.jsx(TestComponent, { data: dataMetadata }));
        const grid = await testHelpers.getRoot(list);
        const items = await testHelpers.getContents(list);
        await userEvent__default["default"].click(items[0]);
        preact.fireEvent.keyDown(grid, { key: 'ArrowDown' });
        const secondRowInput = list.getByTestId('input-1');
        chai.expect(secondRowInput.getAttribute('tabindex')).equals('-1');
        preact.fireEvent.keyDown(grid, { key: 'F2' });
        chai.expect(secondRowInput.getAttribute('tabindex')).equals('0');
    });
    it('enters interactive mode with click on input', async () => {
        const data = listViewTestFixtures.populateData(100, true);
        const dataMetadata = data.map((data) => {
            return { data: data, metadata: { key: data.id } };
        });
        const list = preact.render(jsxRuntime.jsx(TestComponent, { data: dataMetadata }));
        const firstRowInput = list.getByTestId('input-0');
        chai.expect(firstRowInput.getAttribute('tabindex')).equals('-1');
        await userEvent__default["default"].click(firstRowInput);
        // NOTE without this rerender the state change doesn't stick
        list.rerender(jsxRuntime.jsx(TestComponent, { data: dataMetadata }));
        chai.expect(firstRowInput.getAttribute('tabindex')).equals('0');
        chai.expect(document.activeElement).equals(firstRowInput);
        await userEvent__default["default"].tab();
        chai.expect(document.activeElement).equals(list.getByTestId('button-0'));
    });
    // FIXME: reenable this test once  is fixed
    xit('leaves interactive mode with click outside', async () => {
        const data = listViewTestFixtures.populateData(100, true);
        const dataMetadata = data.map((data) => {
            return { data: data, metadata: { key: data.id } };
        });
        const list = preact.render(jsxRuntime.jsx(TestComponent, { data: dataMetadata }));
        const firstRowInput = list.getByTestId('input-0');
        chai.expect(firstRowInput.getAttribute('tabindex')).equals('-1');
        await userEvent__default["default"].click(firstRowInput);
        // NOTE without this rerender the state change doesn't stick
        list.rerender(jsxRuntime.jsx(TestComponent, { data: dataMetadata }));
        chai.expect(firstRowInput.getAttribute('tabindex')).equals('0');
        chai.expect(document.activeElement).equals(firstRowInput);
        const outsideElement = list.getByText('Preceding Button');
        await userEvent__default["default"].click(outsideElement);
        chai.expect(document.activeElement).equals(outsideElement);
        list.rerender(jsxRuntime.jsx(TestComponent, { data: dataMetadata }));
        chai.expect(firstRowInput.getAttribute('tabindex')).equals('-1');
    });
};

exports.testTabbableMode = testTabbableMode;
//# sourceMappingURL=listViewTabbableModeTests-e85c8c82.js.map
