{"version":3,"file":"UNSAFE_DrawerPopup.js","sources":["../../src/UNSAFE_DrawerPopup/DrawerPopup.tsx"],"sourcesContent":["import { JSX, RefObject } from 'preact';\nimport { useState, useRef, useEffect, useCallback } from 'preact/hooks';\nimport { Layer } from '../UNSAFE_Layer';\nimport { Modal } from '../UNSAFE_Modal';\nimport { FocusTrap } from '../UNSAFE_FocusTrap';\nimport { focusOn, focusWithin, getActiveElement } from '../utils/PRIVATE_tabbableUtils';\nimport { normalizePosition } from '../utils/PRIVATE_floatingUtils';\nimport { RtlSide } from '../UNSAFE_Floating';\nimport { getClientHints } from '../utils/PRIVATE_clientHints';\n\n// Hooks\nimport { useOutsideClick } from '../hooks/UNSAFE_useOutsideClick';\nimport { useAnimation } from '../hooks/UNSAFE_useAnimation';\nimport { useUser } from '../hooks/UNSAFE_useUser';\n\n// Style imports\nimport { useComponentTheme } from '../hooks/UNSAFE_useComponentTheme';\nimport { DrawerPopupVariantOptions } from './themes/DrawerPopupStyles.css';\nimport { colorInterpolations, ColorProps } from '../utils/UNSAFE_interpolations/colors';\nimport { mergeInterpolations } from '../utils/UNSAFE_mergeInterpolations';\nimport { DrawerPopupRedwoodTheme } from './themes/redwood/DrawerPopupTheme';\n\n// Types\ntype IntrinsicProps = Pick<JSX.HTMLAttributes<HTMLDivElement>, 'children'>;\ntype Placement = 'start' | 'end' | 'bottom';\ntype NormalizedPlacement = 'left' | 'right' | 'bottom';\ntype Status = 'unmounted' | 'initial' | 'opening' | 'closing';\ntype VisibilityStatus = 'hidden' | 'visible';\ntype DisplayModeHorizontal = 'overlay' | 'fullOverlay';\ntype OnCloseDetail = {\n  reason: 'outsideClick' | 'escapeKey';\n};\n\ntype Props = IntrinsicProps &\n  Pick<ColorProps, 'backgroundColor'> & {\n    /**\n     * Specifies whether the Drawer is open.\n     */\n    isOpen: boolean;\n    /**\n     * Specifies at what edge the Drawer opens.\n     * Supported values are:\n     * <p><code>start</code>, <code>end</code>, <code>bottom</code></p>\n     * Default is <code>start</code>.\n     */\n    placement?: Placement;\n    /**\n     * Specifies modality of the Darwer.\n     * Supported values are:\n     * <p><code>modal</code>, <code>modeless</code></p>\n     * Default is <code>modal</code>.\n     */\n    modality?: 'modal' | 'modeless';\n    /**\n     * Specifies callback triggered when a user tries to close a Drawer through UI interaction.\n     * The parent should listen to this event and close the Drawer. If the parent fails to remove\n     * the Popup, then no change will be done in the UI by the component.\n     * Supported detail values are:\n     * <p><code>outsideClick</code>, <code>escapeKey</code></p>\n     */\n    onClose?: (detail: OnCloseDetail) => void;\n    /**\n     * Specifies callback triggered after the animation ends.\n     */\n    onTransitionEnd?: (value: boolean) => void;\n    /**\n     * Optional ref for an element to focus on when component mounts.\n     */\n    autoFocusRef?: RefObject<HTMLElement>;\n    /**\n     * Specifies guidance for screen readers.\n     */\n    'aria-label'?: string;\n    /**\n     * Specifies ID of an element used for guidance for screen readers.\n     */\n    'aria-labelledby'?: string;\n    /**\n     * Specifies ID of an element (or space separated IDs of multiple elements) that\n     * describes the Drawer.\n     */\n    'aria-describedby'?: string;\n  };\n\n// Constants\nconst displayModefullWidthThreshold = 600;\nconst zero = '0px';\nconst duration = 250;\n\nconst getElementHeight = (element: HTMLDivElement): number => {\n  return Math.round(element.offsetHeight);\n};\n\nconst getElementWidth = (element: HTMLDivElement): number => {\n  return Math.round(element.getBoundingClientRect().width);\n};\n\n/**\n * A drawer popup adds a single slide-in side content alongside some primary content to an application window.\n *\n * This drawer always overlays the page and can be placed at the 'start', 'end' or 'bottom' edge.\n */\nexport const DrawerPopup = ({\n  children,\n  isOpen = false,\n  autoFocusRef,\n  placement = 'start',\n  modality = 'modal',\n  onClose,\n  onTransitionEnd,\n  'aria-label': ariaLabel,\n  'aria-labelledby': ariaLabelledBy,\n  'aria-describedby': ariaDescribedBy,\n  ...props\n}: Props) => {\n  // Initialize states\n  const [status, setStatus] = useState<Status>(isOpen ? 'initial' : 'unmounted');\n  const [visibility, setVisibility] = useState<VisibilityStatus>('hidden');\n  const [isOutsideClickDisabled, setIsOutsideClickDisabled] = useState<boolean>(!isOpen);\n  const [displayModeHorizontal, setDisplayModeHorizontal] =\n    useState<DisplayModeHorizontal>('overlay');\n\n  const rootRef = useRef<HTMLDivElement>(null);\n  const launcherRef = useRef<HTMLElement | null>(null);\n\n  const isBottomPlacement = placement === 'bottom';\n\n  // Animation config\n  const animationStates = {\n    opening: () => {\n      if (isBottomPlacement) {\n        return {\n          from: {\n            translateY: getTranslateY()\n          },\n          to: {\n            translateY: zero\n          },\n          options: {\n            duration: duration\n          }\n        };\n      } else {\n        return {\n          from: {\n            translateX: getTranslateX()\n          },\n          to: {\n            translateX: zero\n          },\n          options: {\n            duration: duration\n          }\n        };\n      }\n    },\n    closing: () => {\n      if (isBottomPlacement) {\n        return {\n          from: {\n            translateY: zero\n          },\n          to: {\n            translateY: getTranslateY()\n          },\n          options: {\n            duration: duration\n          }\n        };\n      } else {\n        return {\n          from: {\n            translateX: zero\n          },\n          to: {\n            translateX: getTranslateX()\n          },\n          options: {\n            duration: duration\n          }\n        };\n      }\n    }\n  };\n\n  // Normalizing position\n  const { direction } = useUser();\n  const getNormalizedPlacement = (): RtlSide => {\n    return normalizePosition(placement, direction);\n  };\n\n  const getTranslateX = (): string => {\n    return `${getNormalizedPlacement() === 'right' ? '' : '-'}${getElementWidth(\n      rootRef.current as HTMLDivElement\n    )}px`;\n  };\n\n  const getTranslateY = (): string => {\n    return `${getElementHeight(rootRef.current as HTMLDivElement)}px`;\n  };\n\n  // Animation\n  const { nodeRef } = useAnimation<Status, HTMLDivElement>(status, {\n    animationStates,\n    isAnimatedOnMount: true,\n    onAnimationEnd: useCallback(() => {\n      if (status === 'opening') {\n        onTransitionEnd?.(true);\n      } else if (!isOpen) {\n        nodeRef(null);\n        setVisibility('hidden');\n        setStatus('unmounted');\n        onTransitionEnd?.(false);\n      }\n    }, [status, isOpen])\n  });\n\n  useEffect(() => {\n    // 1. Ignore status update on initial render\n    if (status === 'unmounted' && !isOpen) {\n      return;\n    }\n\n    // 2. Mount visually hidden component\n    // Component gets mounted, but will be visually hidden to avoid flickering\n    // Flickering happens because it gets rendered before animation hook repositions\n    // it in next render cycle\n    if (status === 'unmounted' && isOpen) {\n      setStatus('initial');\n      return;\n    }\n\n    // 3. Setup animation\n    // Component has been mounted.\n    // We will kick out animation as node is already present in DOM.\n    // To avoid flickering, we still keep it visually hidden until the next render cycle.\n    if (status === 'initial' && isOpen) {\n      nodeRef(rootRef.current);\n      setIsOutsideClickDisabled(false);\n      setStatus('opening');\n      return;\n    }\n\n    // 3. Unhide component. It becomes visible.\n    if (status === 'opening' && isOpen) {\n      setVisibility('visible');\n      return;\n    }\n\n    // 4. Closing\n    if (!isOpen) {\n      setIsOutsideClickDisabled(true);\n      setStatus('closing');\n    }\n  }, [isOpen, status]);\n\n  // Launcher handler\n  useEffect(() => {\n    if (status === 'opening') {\n      // Remember launcher\n      const activeElement = getActiveElement();\n      launcherRef.current = activeElement === document.body ? document.body : activeElement;\n\n      // Register F6 key handler to enter the Popup\n      launcherRef.current?.addEventListener('keydown', launcherKeyDownCallback);\n    }\n    if (status === 'closing') {\n      return () => {\n        // Deregister F6 key handler\n        launcherRef.current?.removeEventListener('keydown', launcherKeyDownCallback);\n      };\n    }\n    return;\n  }, [status]);\n\n  const launcherKeyDownCallback = (event: KeyboardEvent): void => {\n    // Moves focus from launcher (must have focus) back to the Drawer\n    if (launcherRef.current === getActiveElement() && event.code === 'F6') {\n      // Prevent default F6 handlers.\n      // F6 is a standard Chrome address bar shortcut on Windows.\n      event.preventDefault();\n      event.stopPropagation();\n\n      // Focus on first tabbable in a container or container itself if there is none\n      focusWithin(rootRef.current as HTMLElement);\n    }\n  };\n\n  const handleKeyDown = useCallback(\n    (event: KeyboardEvent) => {\n      const launcherEl = launcherRef.current;\n      switch (event.code) {\n        case 'Escape': {\n          onClose?.({ reason: 'escapeKey' });\n          break;\n        }\n        case 'F6':\n          // Prevent default F6 handlers.\n          // F6 is a standard Chrome address bar shortcut on Windows.\n          event.preventDefault();\n          event.stopPropagation();\n          // Focus launcher\n          if (launcherEl) {\n            focusOn(launcherEl);\n          }\n          break;\n      }\n    },\n    [onClose]\n  );\n\n  // OutsideClick handler\n  const handleOutsideClick = useCallback(() => {\n    // Trigger onClose event with outside click detail\n    onClose?.({ reason: 'outsideClick' });\n  }, [onClose]);\n\n  useOutsideClick({\n    isDisabled: isOutsideClickDisabled,\n    ref: rootRef,\n    handler: handleOutsideClick\n  });\n\n  // Drawer placement\n  const getDrawerPlacement = (): NormalizedPlacement => {\n    if (isBottomPlacement) {\n      return placement;\n    } else {\n      if (direction === 'rtl') {\n        return placement === 'start' ? 'right' : 'left';\n      } else {\n        return placement === 'start' ? 'left' : 'right';\n      }\n    }\n  };\n\n  // Window resize handler\n  // Handles display mode: Overlay <> Full overlay (full width side drawers)\n  const handleResize = () => {\n    const viewportWidth = getViewportWidth();\n    if (displayModeHorizontal === 'overlay' && viewportWidth < displayModefullWidthThreshold) {\n      setDisplayModeHorizontal('fullOverlay');\n    }\n    if (displayModeHorizontal === 'fullOverlay' && viewportWidth > displayModefullWidthThreshold) {\n      setDisplayModeHorizontal('overlay');\n    }\n  };\n\n  const clientHints = getClientHints();\n  const getViewportWidth = (): number => {\n    if (clientHints.platform === 'ios') {\n      // On ios window.innerWidth is not recommended way of measuring the viewport\n      return document.documentElement.clientWidth;\n    }\n    return window.innerWidth;\n  };\n\n  useEffect(() => {\n    const root = rootRef.current;\n    if (root) {\n      const resizeObserver = new ResizeObserver(() => {\n        handleResize();\n      });\n      resizeObserver.observe(document.body);\n      return () => {\n        resizeObserver.unobserve(document.body);\n      };\n    }\n    return undefined;\n  }, [handleResize]);\n\n  // Styles\n  const { classes } = useComponentTheme<DrawerPopupVariantOptions>(DrawerPopupRedwoodTheme, {\n    placement: getDrawerPlacement(),\n    visibility,\n    displayModeHorizontal\n  });\n\n  const interpolations = [...Object.values(colorInterpolations)];\n  const styleInterpolations = mergeInterpolations<ColorProps>(interpolations);\n  const { ...styles } = styleInterpolations(props);\n\n  const renderDrawer = () => {\n    return (\n      <div\n        ref={rootRef}\n        className={classes}\n        style={styles}\n        tabIndex={-1}\n        role=\"dialog\"\n        onKeyDown={handleKeyDown}\n        aria-label={ariaLabel}\n        aria-labeledby={ariaLabelledBy}\n        aria-describedby={ariaDescribedBy}>\n        <FocusTrap autoFocusRef={autoFocusRef}>{children}</FocusTrap>\n      </div>\n    );\n  };\n\n  const isMounted = status !== 'unmounted';\n  if (isMounted) {\n    // Modal vs. modelss upper wrapper\n    if (modality === 'modal') {\n      return <Modal isOpen={isMounted}>{renderDrawer()}</Modal>;\n    } else {\n      return <Layer>{renderDrawer()}</Layer>;\n    }\n  }\n\n  return null;\n};\n"],"names":["_jsx"],"mappings":"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"}