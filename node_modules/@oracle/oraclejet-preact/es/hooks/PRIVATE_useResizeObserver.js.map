{"version":3,"file":"PRIVATE_useResizeObserver.js","sources":["../../../src/hooks/PRIVATE_useResizeObserver/useResizeObserver.ts","../../../src/hooks/PRIVATE_useResizeObserver/index.ts"],"sourcesContent":["import { RefObject } from 'preact';\nimport { useLayoutEffect } from 'preact/hooks';\n\n// Use a shared ResizeObserver to observe all components using this hook.\n// This is much more performant than using one ResizeObserver per element:\n// https://groups.google.com/a/chromium.org/g/blink-dev/c/z6ienONUb5A/m/F5-VcUZtBAAJ\n\ntype UseResizeObserverCallback = (entry: ResizeObserverEntry) => void;\n\nclass SharedResizeObserver {\n  private readonly targetCallbacks: Map<Element, UseResizeObserverCallback>;\n  private readonly resizeObserver: ResizeObserver;\n\n  constructor() {\n    this.targetCallbacks = new Map();\n    this.resizeObserver = new ResizeObserver((entries) => {\n      for (const entry of entries) {\n        const cb = this.targetCallbacks.get(entry.target);\n        if (cb) cb(entry);\n      }\n    });\n  }\n\n  subscribe(target: Element, callback: UseResizeObserverCallback, options?: ResizeObserverOptions) {\n    this.targetCallbacks.set(target, callback);\n    this.resizeObserver.observe(target, options);\n  }\n\n  unsubscribe(target: Element) {\n    this.resizeObserver.unobserve(target);\n    this.targetCallbacks.delete(target);\n  }\n}\n\nconst sharedResizeObserver = new SharedResizeObserver();\n\nconst useResizeObserver = (\n  ref: RefObject<Element>,\n  callback: UseResizeObserverCallback,\n  resizeObserverOptions?: ResizeObserverOptions\n) => {\n  useLayoutEffect(() => {\n    if (!ref.current) return;\n\n    const target = ref.current;\n    sharedResizeObserver.subscribe(target, callback, resizeObserverOptions);\n\n    return () => sharedResizeObserver.unsubscribe(target);\n  }, [ref]);\n};\n\nexport { useResizeObserver };\n","/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\nexport { useResizeObserver } from './useResizeObserver';\n"],"names":[],"mappings":";;;AASA,MAAM,oBAAoB,CAAA;AAIxB,IAAA,WAAA,GAAA;AACE,QAAA,IAAI,CAAC,eAAe,GAAG,IAAI,GAAG,EAAE,CAAC;QACjC,IAAI,CAAC,cAAc,GAAG,IAAI,cAAc,CAAC,CAAC,OAAO,KAAI;AACnD,YAAA,KAAK,MAAM,KAAK,IAAI,OAAO,EAAE;AAC3B,gBAAA,MAAM,EAAE,GAAG,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;AAClD,gBAAA,IAAI,EAAE;oBAAE,EAAE,CAAC,KAAK,CAAC,CAAC;AACnB,aAAA;AACH,SAAC,CAAC,CAAC;KACJ;AAED,IAAA,SAAS,CAAC,MAAe,EAAE,QAAmC,EAAE,OAA+B,EAAA;QAC7F,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;QAC3C,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;KAC9C;AAED,IAAA,WAAW,CAAC,MAAe,EAAA;AACzB,QAAA,IAAI,CAAC,cAAc,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;AACtC,QAAA,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;KACrC;AACF,CAAA;AAED,MAAM,oBAAoB,GAAG,IAAI,oBAAoB,EAAE,CAAC;AAElD,MAAA,iBAAiB,GAAG,CACxB,GAAuB,EACvB,QAAmC,EACnC,qBAA6C,KAC3C;IACF,eAAe,CAAC,MAAK;QACnB,IAAI,CAAC,GAAG,CAAC,OAAO;YAAE,OAAO;AAEzB,QAAA,MAAM,MAAM,GAAG,GAAG,CAAC,OAAO,CAAC;QAC3B,oBAAoB,CAAC,SAAS,CAAC,MAAM,EAAE,QAAQ,EAAE,qBAAqB,CAAC,CAAC;QAExE,OAAO,MAAM,oBAAoB,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;AACxD,KAAC,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC;AACZ;;ACjDA;;;;;;AAMG;;;;"}