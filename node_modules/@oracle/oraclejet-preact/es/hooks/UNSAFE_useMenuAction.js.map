{"version":3,"file":"UNSAFE_useMenuAction.js","sources":["../../../src/hooks/UNSAFE_useMenuAction/useMenuAction.ts","../../../src/hooks/UNSAFE_useMenuAction/index.ts"],"sourcesContent":["import { ComponentProps } from 'preact';\nimport { useState, useCallback } from 'preact/hooks';\nimport { RefObject } from 'preact/compat';\nimport { Menu } from '../../UNSAFE_Menu';\nimport { BaseButton } from '../../UNSAFE_BaseButton';\n\ntype InitialFocusType = ComponentProps<typeof Menu>['initialFocus'];\ntype MenuProps = {\n  isOpen?: ComponentProps<typeof Menu>['isOpen'];\n  anchorRef: ComponentProps<typeof Menu>['anchorRef'];\n  initialFocus?: InitialFocusType;\n  onClose: ComponentProps<typeof Menu>['onClose'];\n};\n\nexport type MenuToggleDetail = {\n  value: boolean;\n};\n\nexport type MenuActionOptions = {\n  isDisabled?: boolean;\n  anchorRef: RefObject<HTMLElement>;\n  onToggleMenu?: (details: MenuToggleDetail) => void;\n  isMenuOpen?: boolean;\n};\n\nexport type MenuActionReturnType = {\n  triggerProps: Record<string, any>;\n  menuProps: MenuProps;\n};\n\n/**\n * Use to associate a popup menu with a target that supports onAction\n *\n * @returns\n */\nexport function useMenuAction({\n  isDisabled,\n  isMenuOpen,\n  onToggleMenu,\n  anchorRef\n}: MenuActionOptions): MenuActionReturnType {\n  const [initialFocus, setInitialFocus] = useState<InitialFocusType>('menu');\n\n  const handleAction = useCallback(\n    ((details) => {\n      if (details.reason === 'keyboard') {\n        setInitialFocus('firstItem');\n      } else {\n        setInitialFocus('menu');\n      }\n\n      onToggleMenu?.({\n        value: !isMenuOpen\n      });\n    }) as Required<ComponentProps<typeof BaseButton>>['onAction'],\n    [onToggleMenu, isMenuOpen, setInitialFocus]\n  );\n\n  const handleClose = useCallback<Required<ComponentProps<typeof Menu>>['onClose']>(\n    (detail) => {\n      if (detail.reason === 'outsideClick' && detail.target === anchorRef.current) {\n        return;\n      }\n\n      //Focus has to be set on the launcher when menu is dismissed or\n      //item is \"selected\"\n      if (detail.reason === 'dismissed' || detail.reason === 'itemAction') {\n        anchorRef.current?.focus();\n      }\n\n      onToggleMenu?.({\n        value: false\n      });\n    },\n    [onToggleMenu, anchorRef]\n  );\n\n  const menuProps = {\n    anchorRef: anchorRef,\n    isOpen: isMenuOpen,\n    onClose: handleClose,\n    initialFocus: initialFocus\n  };\n\n  const triggerProps = isDisabled\n    ? {}\n    : {\n        onAction: handleAction,\n        'aria-haspopup': 'true',\n        'aria-expanded': isMenuOpen\n      };\n\n  return {\n    triggerProps: triggerProps,\n    menuProps: menuProps\n  };\n}\n","/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\nexport { useMenuAction, MenuToggleDetail, MenuActionOptions } from './useMenuAction';\n"],"names":[],"mappings":";;;AA8BA;;;;AAIG;AACG,SAAU,aAAa,CAAC,EAC5B,UAAU,EACV,UAAU,EACV,YAAY,EACZ,SAAS,EACS,EAAA;IAClB,MAAM,CAAC,YAAY,EAAE,eAAe,CAAC,GAAG,QAAQ,CAAmB,MAAM,CAAC,CAAC;IAE3E,MAAM,YAAY,GAAG,WAAW,EAC7B,CAAC,OAAO,KAAI;AACX,QAAA,IAAI,OAAO,CAAC,MAAM,KAAK,UAAU,EAAE;YACjC,eAAe,CAAC,WAAW,CAAC,CAAC;AAC9B,SAAA;AAAM,aAAA;YACL,eAAe,CAAC,MAAM,CAAC,CAAC;AACzB,SAAA;AAED,QAAA,YAAY,GAAG;YACb,KAAK,EAAE,CAAC,UAAU;AACnB,SAAA,CAAC,CAAC;KACJ,GACD,CAAC,YAAY,EAAE,UAAU,EAAE,eAAe,CAAC,CAC5C,CAAC;AAEF,IAAA,MAAM,WAAW,GAAG,WAAW,CAC7B,CAAC,MAAM,KAAI;AACT,QAAA,IAAI,MAAM,CAAC,MAAM,KAAK,cAAc,IAAI,MAAM,CAAC,MAAM,KAAK,SAAS,CAAC,OAAO,EAAE;YAC3E,OAAO;AACR,SAAA;;;QAID,IAAI,MAAM,CAAC,MAAM,KAAK,WAAW,IAAI,MAAM,CAAC,MAAM,KAAK,YAAY,EAAE;AACnE,YAAA,SAAS,CAAC,OAAO,EAAE,KAAK,EAAE,CAAC;AAC5B,SAAA;AAED,QAAA,YAAY,GAAG;AACb,YAAA,KAAK,EAAE,KAAK;AACb,SAAA,CAAC,CAAC;AACL,KAAC,EACD,CAAC,YAAY,EAAE,SAAS,CAAC,CAC1B,CAAC;AAEF,IAAA,MAAM,SAAS,GAAG;AAChB,QAAA,SAAS,EAAE,SAAS;AACpB,QAAA,MAAM,EAAE,UAAU;AAClB,QAAA,OAAO,EAAE,WAAW;AACpB,QAAA,YAAY,EAAE,YAAY;KAC3B,CAAC;IAEF,MAAM,YAAY,GAAG,UAAU;AAC7B,UAAE,EAAE;AACJ,UAAE;AACE,YAAA,QAAQ,EAAE,YAAY;AACtB,YAAA,eAAe,EAAE,MAAM;AACvB,YAAA,eAAe,EAAE,UAAU;SAC5B,CAAC;IAEN,OAAO;AACL,QAAA,YAAY,EAAE,YAAY;AAC1B,QAAA,SAAS,EAAE,SAAS;KACrB,CAAC;AACJ;;AChGA;;;;;;AAMG;;;;"}