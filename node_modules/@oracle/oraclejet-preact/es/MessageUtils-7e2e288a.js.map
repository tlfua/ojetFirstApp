{"version":3,"file":"MessageUtils-7e2e288a.js","sources":["../../src/PRIVATE_Message/MessageUtils.ts"],"sourcesContent":["/**\n * @license\n * Copyright (c) %FIRST_YEAR% %CURRENT_YEAR%, Oracle and/or its affiliates.\n * The Universal Permissive License (UPL), Version 1.0\n * as shown at https://oss.oracle.com/licenses/upl/\n * @ignore\n */\nimport { ComponentChildren } from 'preact';\nimport { Item } from '../utils/UNSAFE_dataProvider';\nimport { Logger } from '../utils/UNSAFE_logger';\nimport { playAudioFromURL, playDefaultNotificationSound } from '../utils/UNSAFE_soundUtils';\nimport { isValidValueForProp } from './MessageFormattingUtils';\nimport { MessageSeverity, MessageVariant } from './Message.types';\n\n/**\n * Logger that prepends the component name to the message\n */\nconst MessageLogger = {\n  error: (message: string, type = 'common') => Logger.error(`JET Message(${type}): ${message}`),\n  warn: (message: string, type = 'common') => Logger.warn(`JET Message(${type}): ${message}`),\n  info: (message: string, type = 'common') => Logger.info(`JET Message(${type}): ${message}`),\n  log: (message: string, type = 'common') => Logger.log(`JET Message(${type}): ${message}`)\n};\n\n/**\n * Plays a sound based on the provided argument. Supported keywords:\n * 1. default - plays the default beep sound\n * 2. none - no sound will be played\n *\n * @param sound Supported keywords or URL to an audio file\n */\nasync function playSound(sound: string) {\n  if (sound === 'none') {\n    // no need to play any audio\n    return;\n  }\n\n  // For default, we play a beep sound using WebAudio API\n  if (sound === 'default') {\n    try {\n      playDefaultNotificationSound();\n    } catch (error) {\n      // Default sound is not played due to some error\n      // Log a message and return doing nothing else\n      MessageLogger.warn(`Failed to play the default sound. ${error}.`);\n    }\n    return;\n  }\n\n  // If it is not a key word, then it is an URL\n  try {\n    await playAudioFromURL(sound);\n  } catch (error) {\n    // Playing audio using the URL failed.\n    MessageLogger.warn(`Failed to play the audio from the url ${sound}. ${error}.`);\n  }\n}\n\n/**\n * A helper function that throws an error\n *\n * @param message The error message\n * @param type The type of the message that is throwing an error\n * @throws {Error}\n */\nfunction throwError(message: string, type = 'common') {\n  throw new Error(`JET Message(${type}) - ${message}`);\n}\n\n/**\n * Fetches a renderer for the current message if one is provided\n *\n * @param message The item context for the current message\n * @param rendererIdentifier Identifier of the current renderer\n * @param renderers All available renderers\n * @returns The renderer for rendering the custom content\n */\nfunction getRenderer<K, D, R>(\n  message: Item<K, D>,\n  rendererIdentifier?: string | ((item: Item<K, D>) => string | undefined),\n  renderers?: Record<string, (data: R) => ComponentChildren>,\n  type?: string\n) {\n  // If either detailRenderer function or record of renderers are not available,\n  // return null\n  if (!rendererIdentifier || !renderers) {\n    return undefined;\n  }\n\n  const rendererKey =\n    typeof rendererIdentifier === 'function' ? rendererIdentifier(message) : rendererIdentifier;\n\n  // If rendererKey is null or undefined, then we need to use default rendering\n  // so return null\n  if (rendererKey == null) {\n    return undefined;\n  }\n\n  // If the returned render key is a string but does not exist in the provided\n  // record of renderers, throw an error\n  if (!(rendererKey in renderers)) {\n    throwError(\n      `${rendererKey} is not a valid template name for the message with key=${message.key}`,\n      type\n    );\n  }\n\n  // Else, fetch and return the renderer\n  return renderers[rendererKey];\n}\n\n/**\n * Fetches a renderer for the current message if one is provided.\n * Proxies the said renderer to exclude the index in the payload.\n *\n * @param message The item context for the current message\n * @param rendererIdentifier Identifier of the current renderer\n * @param renderers All available renderers\n * @returns The renderer for rendering the custom content\n */\nfunction getRendererWithoutIndex<K, D, R extends object>(\n  message: Item<K, D>,\n  rendererIdentifier?: string | ((item: Item<K, D>) => string | undefined),\n  renderers?: Record<string, (data: R) => ComponentChildren>,\n  type?: string\n) {\n  const renderer = getRenderer(message, rendererIdentifier, renderers, type);\n  if (typeof renderer === 'function') {\n    return (data: R) => {\n      const dataCopy = { ...data };\n      if ('index' in dataCopy) {\n        delete (dataCopy as any)['index'];\n      }\n      return renderer.call(null, dataCopy);\n    };\n  }\n  return renderer;\n}\n\n/**\n * Generates a root style class based on the severity. For invalid severity and severity=none\n * no specific style class exists.\n *\n * @param severity The message severity\n * @returns calculated style class based on the severity\n */\nfunction severityBasedStyleClass(severity: MessageSeverity, variant: MessageVariant) {\n  const isValidSeverity = isValidValueForProp(severity, 'severity');\n  return isValidSeverity && severity !== 'none' ? `oj-c-message${variant}-${severity}` : '';\n}\n\n/**\n * Determines if a severity icon is needed based on the component severity\n *\n * @param severity The component severity\n * @returns Whether or not to render the severity icon\n */\nfunction isSeverityIconNeeded(\n  severity: MessageSeverity\n): severity is Exclude<MessageSeverity, 'none'> {\n  const isValidSeverity = isValidValueForProp(severity, 'severity');\n  return isValidSeverity && severity !== 'none';\n}\n\nexport {\n  getRenderer,\n  getRendererWithoutIndex,\n  playSound,\n  throwError,\n  severityBasedStyleClass,\n  isSeverityIconNeeded\n};\n"],"names":[],"mappings":"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"}