{"version":3,"file":"PRIVATE_collectionUtils.js","sources":["../../../src/utils/PRIVATE_collectionUtils/collectionUtils.ts"],"sourcesContent":["import { RefObject } from 'preact';\nimport { ViewportConfig } from '../../hooks/UNSAFE_useViewportIntersect';\nimport { SelectionRangeDetail } from '../../hooks/PRIVATE_useSelection';\nimport { isKeyDefined } from '../UNSAFE_keys';\nimport { getClientHints } from '../PRIVATE_clientHints';\n\n/**\n * Returns the key from the item element\n */\nconst getKey = (item: HTMLElement) => {\n  return item.dataset['ojKeyType'] === 'number'\n    ? Number(item.dataset['ojKey'])\n    : item.dataset['ojKey'];\n};\n\n/**\n * A helper function that return the key of the first available item.\n */\nexport const getFirstVisibleKey = (root: HTMLElement, itemSelector: string) => {\n  if (root) {\n    const firstItem = root.querySelector(itemSelector);\n    if (firstItem) {\n      const key = getKey(firstItem as HTMLElement);\n      return key;\n    }\n  }\n  return null;\n};\n\n/**\n * A helper function to find the element with the specified key.\n * Returns null if the element with key is not found.\n */\nexport const findElementByKey = <K extends string | number>(\n  root: HTMLElement,\n  key: K,\n  itemSelector: string\n) => {\n  if (root) {\n    const items = root.querySelectorAll(itemSelector);\n    for (let i = 0; i < items.length; i++) {\n      const thisKey = getKey(items[i] as HTMLElement);\n      if (key == (thisKey as K)) {\n        return items[i];\n      }\n    }\n  }\n  return null;\n};\n\n/**\n * A helper function that returns the key of the previous or the next item\n * given the specified current key\n */\nexport const getPrevNextKey = <K extends string | number>(\n  root: HTMLElement | null,\n  currentKey: K | undefined,\n  isPrev: boolean,\n  itemSelector: string\n) => {\n  return (): K | null => {\n    if (isKeyDefined(currentKey) && root) {\n      const currItem = findElementByKey(root, currentKey as K, itemSelector);\n      if (currItem) {\n        const nextItem = isPrev ? currItem.previousElementSibling : currItem.nextElementSibling;\n        if (nextItem) {\n          const key = getKey(nextItem as HTMLElement) as K;\n          if (key != null) {\n            return key;\n          }\n        }\n        // no next item or next item is not a valid item\n        return null;\n      }\n      return getFirstVisibleKey(root, itemSelector) as K;\n    }\n    return null;\n  };\n};\n\n/**\n * A helper function that returns the key of the previous or the next item by count,\n * given the specified current key\n */\nexport const getPrevNextKeyByCount = <K, D>(\n  data: D[] | null,\n  getRowKey: (data: D) => K,\n  currentKey?: K,\n  count = 0\n) => {\n  if (data && currentKey != undefined) {\n    const currIndex = data.findIndex((d) => {\n      return getRowKey(d) === currentKey;\n    });\n    const nextIndex = currIndex + count;\n    if (0 <= nextIndex && nextIndex < data.length) {\n      return getRowKey(data[nextIndex]);\n    }\n    return null;\n  }\n  return null;\n};\n\n/**\n * A helper function to get the key from an element\n */\nexport const keyExtractor = <K extends string | number>(\n  element: HTMLElement,\n  itemSelector: string\n): K | null => {\n  const item = element.closest(itemSelector);\n  if (item) {\n    const key = getKey(item as HTMLElement) as K;\n    return key === undefined ? null : key;\n  }\n  return null;\n};\n\n/**\n * A helper function to that return viewPortConfig to collection components\n */\nexport const getViewportConfig = (rootRef: RefObject<HTMLElement>, config?: ViewportConfig) => {\n  return (\n    config ?? {\n      scroller: () => {\n        return rootRef.current;\n      }\n    }\n  );\n};\n\n/**\n * A helper function to handle range selection\n */\nexport const handleSelectionRange = <K, D>(\n  detail: SelectionRangeDetail<K>,\n  data: D[],\n  getRowKey: (data: D) => K\n) => {\n  const keys = data.map((value: D) => {\n    return getRowKey(value);\n  });\n  const startIndex = keys.indexOf(detail.value.start);\n  const endIndex = keys.indexOf(detail.value.end);\n  const minIndex = Math.min(startIndex, endIndex);\n  const maxIndex = Math.max(startIndex, endIndex);\n  if (minIndex === -1) {\n    // return a range to fetch so we can find all the keys, maxIndex should not be -1\n    return { offset: 0, count: -1 };\n  } else {\n    // range of keys are in the current viewport, return them\n    return keys.slice(minIndex, maxIndex + 1);\n  }\n};\n\n/**\n * Helper function to determine whether the current device is a mobile device\n * @returns true if running on a mobile device, false otherwise\n */\nexport function isMobile() {\n  const deviceType = getClientHints().deviceType;\n  return deviceType === 'phone' || deviceType === 'tablet';\n}\n"],"names":[],"mappings":";;;;;AAMA;;AAEG;AACH,MAAM,MAAM,GAAG,CAAC,IAAiB,KAAI;AACnC,IAAA,OAAO,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,KAAK,QAAQ;UACzC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;AAC/B,UAAE,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;AAC5B,CAAC,CAAC;AAEF;;AAEG;MACU,kBAAkB,GAAG,CAAC,IAAiB,EAAE,YAAoB,KAAI;AAC5E,IAAA,IAAI,IAAI,EAAE;QACR,MAAM,SAAS,GAAG,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,CAAC;AACnD,QAAA,IAAI,SAAS,EAAE;AACb,YAAA,MAAM,GAAG,GAAG,MAAM,CAAC,SAAwB,CAAC,CAAC;AAC7C,YAAA,OAAO,GAAG,CAAC;AACZ,SAAA;AACF,KAAA;AACD,IAAA,OAAO,IAAI,CAAC;AACd,EAAE;AAEF;;;AAGG;AACU,MAAA,gBAAgB,GAAG,CAC9B,IAAiB,EACjB,GAAM,EACN,YAAoB,KAClB;AACF,IAAA,IAAI,IAAI,EAAE;QACR,MAAM,KAAK,GAAG,IAAI,CAAC,gBAAgB,CAAC,YAAY,CAAC,CAAC;AAClD,QAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACrC,MAAM,OAAO,GAAG,MAAM,CAAC,KAAK,CAAC,CAAC,CAAgB,CAAC,CAAC;YAChD,IAAI,GAAG,IAAK,OAAa,EAAE;AACzB,gBAAA,OAAO,KAAK,CAAC,CAAC,CAAC,CAAC;AACjB,aAAA;AACF,SAAA;AACF,KAAA;AACD,IAAA,OAAO,IAAI,CAAC;AACd,EAAE;AAEF;;;AAGG;AACI,MAAM,cAAc,GAAG,CAC5B,IAAwB,EACxB,UAAyB,EACzB,MAAe,EACf,YAAoB,KAClB;AACF,IAAA,OAAO,MAAe;AACpB,QAAA,IAAI,YAAY,CAAC,UAAU,CAAC,IAAI,IAAI,EAAE;YACpC,MAAM,QAAQ,GAAG,gBAAgB,CAAC,IAAI,EAAE,UAAe,EAAE,YAAY,CAAC,CAAC;AACvE,YAAA,IAAI,QAAQ,EAAE;AACZ,gBAAA,MAAM,QAAQ,GAAG,MAAM,GAAG,QAAQ,CAAC,sBAAsB,GAAG,QAAQ,CAAC,kBAAkB,CAAC;AACxF,gBAAA,IAAI,QAAQ,EAAE;AACZ,oBAAA,MAAM,GAAG,GAAG,MAAM,CAAC,QAAuB,CAAM,CAAC;oBACjD,IAAI,GAAG,IAAI,IAAI,EAAE;AACf,wBAAA,OAAO,GAAG,CAAC;AACZ,qBAAA;AACF,iBAAA;;AAED,gBAAA,OAAO,IAAI,CAAC;AACb,aAAA;AACD,YAAA,OAAO,kBAAkB,CAAC,IAAI,EAAE,YAAY,CAAM,CAAC;AACpD,SAAA;AACD,QAAA,OAAO,IAAI,CAAC;AACd,KAAC,CAAC;AACJ,EAAE;AAEF;;;AAGG;AACI,MAAM,qBAAqB,GAAG,CACnC,IAAgB,EAChB,SAAyB,EACzB,UAAc,EACd,KAAK,GAAG,CAAC,KACP;AACF,IAAA,IAAI,IAAI,IAAI,UAAU,IAAI,SAAS,EAAE;QACnC,MAAM,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,KAAI;AACrC,YAAA,OAAO,SAAS,CAAC,CAAC,CAAC,KAAK,UAAU,CAAC;AACrC,SAAC,CAAC,CAAC;AACH,QAAA,MAAM,SAAS,GAAG,SAAS,GAAG,KAAK,CAAC;QACpC,IAAI,CAAC,IAAI,SAAS,IAAI,SAAS,GAAG,IAAI,CAAC,MAAM,EAAE;AAC7C,YAAA,OAAO,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;AACnC,SAAA;AACD,QAAA,OAAO,IAAI,CAAC;AACb,KAAA;AACD,IAAA,OAAO,IAAI,CAAC;AACd,EAAE;AAEF;;AAEG;MACU,YAAY,GAAG,CAC1B,OAAoB,EACpB,YAAoB,KACR;IACZ,MAAM,IAAI,GAAG,OAAO,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC;AAC3C,IAAA,IAAI,IAAI,EAAE;AACR,QAAA,MAAM,GAAG,GAAG,MAAM,CAAC,IAAmB,CAAM,CAAC;QAC7C,OAAO,GAAG,KAAK,SAAS,GAAG,IAAI,GAAG,GAAG,CAAC;AACvC,KAAA;AACD,IAAA,OAAO,IAAI,CAAC;AACd,EAAE;AAEF;;AAEG;MACU,iBAAiB,GAAG,CAAC,OAA+B,EAAE,MAAuB,KAAI;IAC5F,QACE,MAAM,IAAI;QACR,QAAQ,EAAE,MAAK;YACb,OAAO,OAAO,CAAC,OAAO,CAAC;SACxB;AACF,KAAA,EACD;AACJ,EAAE;AAEF;;AAEG;AACU,MAAA,oBAAoB,GAAG,CAClC,MAA+B,EAC/B,IAAS,EACT,SAAyB,KACvB;IACF,MAAM,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,KAAQ,KAAI;AACjC,QAAA,OAAO,SAAS,CAAC,KAAK,CAAC,CAAC;AAC1B,KAAC,CAAC,CAAC;AACH,IAAA,MAAM,UAAU,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;AACpD,IAAA,MAAM,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;IAChD,MAAM,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;IAChD,MAAM,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;AAChD,IAAA,IAAI,QAAQ,KAAK,CAAC,CAAC,EAAE;;QAEnB,OAAO,EAAE,MAAM,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,CAAC,EAAE,CAAC;AACjC,KAAA;AAAM,SAAA;;QAEL,OAAO,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE,QAAQ,GAAG,CAAC,CAAC,CAAC;AAC3C,KAAA;AACH,EAAE;AAEF;;;AAGG;SACa,QAAQ,GAAA;AACtB,IAAA,MAAM,UAAU,GAAG,cAAc,EAAE,CAAC,UAAU,CAAC;AAC/C,IAAA,OAAO,UAAU,KAAK,OAAO,IAAI,UAAU,KAAK,QAAQ,CAAC;AAC3D;;;;"}