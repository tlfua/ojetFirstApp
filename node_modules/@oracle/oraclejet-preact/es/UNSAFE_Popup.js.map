{"version":3,"file":"UNSAFE_Popup.js","sources":["../../src/UNSAFE_Popup/usePopupAnimation.ts","../../src/UNSAFE_Popup/Popup.tsx"],"sourcesContent":["import { Placement, RtlSide } from '../UNSAFE_Floating';\nimport {\n  useAnimationStatus,\n  AnimationStatus,\n  AnimationStatusProps\n} from '../hooks/PRIVATE_useAnimationStatus';\nimport { normalizePosition } from '../utils/PRIVATE_floatingUtils';\nimport { useUser } from '../hooks/UNSAFE_useUser';\nimport { useEffect } from 'preact/hooks';\n\n/**\n * The placement and direction aware HTML element\n * The useAnimation hook do not allow to change dynamically the animation states,\n * but allows a function that returns animation states config. The function takes\n * the animated node of type <E extends HTMLElement> as an argument. This could be used\n * to extend HTMLElement with placement and direction.\n */\ntype AnimationPopupElement = HTMLElement & {\n  placement?: Placement;\n  direction?: 'ltr' | 'rtl';\n};\n\ntype PopupAnimationProps = Omit<AnimationStatusProps, 'animationStates'> & {\n  placement: Placement;\n};\n\nconst animationStates = {\n  opening: (node: AnimationPopupElement) => {\n    const realPlacement = logicalSide(node.placement, node.direction);\n    return {\n      //zoomIn\n      from: {\n        scaleX: 0,\n        scaleY: 0,\n        opacity: 0,\n        transformOrigin: _ANIMATION_TRANSFORM_ORIGIN_RULES[realPlacement]\n      },\n      to: {\n        scaleX: 1,\n        scaleY: 1,\n        opacity: 1,\n        transformOrigin: _ANIMATION_TRANSFORM_ORIGIN_RULES[realPlacement]\n      },\n      options: {\n        duration: 200\n      }\n    };\n  },\n  closing: (node: AnimationPopupElement) => {\n    const realPlacement = logicalSide(node.placement, node.direction);\n    return {\n      //zoomOut\n      from: {\n        scaleX: 1,\n        scaleY: 1,\n        opacity: 1,\n        transformOrigin: _ANIMATION_TRANSFORM_ORIGIN_RULES[realPlacement]\n      },\n      to: {\n        scaleX: 0,\n        scaleY: 0,\n        opacity: 0,\n        transformOrigin: _ANIMATION_TRANSFORM_ORIGIN_RULES[realPlacement]\n      },\n      options: {\n        duration: 200\n      }\n    };\n  }\n};\n\nconst _ANIMATION_TRANSFORM_ORIGIN_RULES = {\n  top: 'center bottom',\n  'top-right': 'right bottom',\n  'top-left': 'left bottom',\n  'top-right-corner': 'left bottom',\n  'top-left-corner': 'right bottom',\n  right: 'left center',\n  'right-top': 'left top',\n  'right-bottom': 'left bottom',\n  'right-top-corner': 'left bottom',\n  'right-bottom-corner': 'left top',\n  bottom: 'center top',\n  'bottom-right': 'right top',\n  'bottom-left': 'left top',\n  'bottom-right-corner': 'left top',\n  'bottom-left-corner': 'right top',\n  left: 'right center',\n  'left-top': 'right top',\n  'left-bottom': 'right bottom',\n  'left-top-corner': 'right bottom',\n  'left-bottom-corner': 'right top'\n};\n\ntype RealPlacement =\n  | 'top'\n  | 'top-right'\n  | 'top-left'\n  | 'top-right-corner'\n  | 'top-left-corner'\n  | 'right'\n  | 'right-top'\n  | 'right-bottom'\n  | 'right-top-corner'\n  | 'right-bottom-corner'\n  | 'bottom'\n  | 'bottom-right'\n  | 'bottom-left'\n  | 'bottom-right-corner'\n  | 'bottom-left-corner'\n  | 'left'\n  | 'left-top'\n  | 'left-bottom'\n  | 'left-top-corner'\n  | 'left-bottom-corner';\n\nconst logicalSide = (\n  placement: Placement | undefined,\n  direction: 'rtl' | 'ltr' | undefined\n): RealPlacement => {\n  if (placement == null || direction == null) return 'bottom';\n  const side = placement.split('-')[0] as RtlSide;\n  const alignment = placement.split('-')[1] as RtlSide;\n  const corner = placement.split('-')[2];\n  const physicalSide = normalizePosition(side, direction);\n  const placements: Array<RealPlacement> = [\n    'top',\n    'top-right',\n    'top-left',\n    'top-right-corner',\n    'top-left-corner',\n    'right',\n    'right-top',\n    'right-bottom',\n    'right-top-corner',\n    'right-bottom-corner',\n    'bottom',\n    'bottom-right',\n    'bottom-left',\n    'bottom-right-corner',\n    'bottom-left-corner',\n    'left',\n    'left-top',\n    'left-bottom',\n    'left-top-corner',\n    'left-bottom-corner'\n  ];\n  const newPlacement: RealPlacement = placements.filter(\n    (placement) =>\n      (alignment &&\n        corner &&\n        placement === `${physicalSide}-${normalizePosition(alignment, direction)}-${corner}`) ||\n      (alignment &&\n        !corner &&\n        placement === `${physicalSide}-${normalizePosition(alignment, direction)}`) ||\n      (!alignment && placement === `${physicalSide}`)\n  )[0];\n  if (!newPlacement) {\n    return 'bottom';\n  }\n\n  return newPlacement;\n};\n\nexport function usePopupAnimation(props: PopupAnimationProps): {\n  status: AnimationStatus;\n  setAnimationElementRef: (node: HTMLElement | null) => void;\n} {\n  const { isOpen, isAnimatedOnMount, onTransitionEnd, placement } = props;\n  const { direction } = useUser();\n  const { setAnimationElementRef, animationElementRef, status } =\n    useAnimationStatus<AnimationPopupElement>({\n      isOpen: isOpen,\n      isAnimatedOnMount: isAnimatedOnMount,\n      animationStates,\n      onTransitionEnd\n    });\n  const popupElementRef = animationElementRef;\n\n  //This is needed for the case if popup flips and changes the placement.\n  useEffect(() => {\n    if (popupElementRef != null && popupElementRef.current != null && status != 'unmounted') {\n      popupElementRef.current.placement = placement;\n      popupElementRef.current.direction = direction;\n    }\n  }, [popupElementRef, placement, direction, status]);\n  return { setAnimationElementRef, status };\n}\n","import { JSX, RefObject } from 'preact';\nimport { useState, useEffect, useLayoutEffect, useMemo, useRef, useCallback } from 'preact/hooks';\nimport {\n  Floating,\n  Offset,\n  Placement,\n  Coords,\n  FlipOptions,\n  ShiftOptions,\n  PositionData\n} from '../UNSAFE_Floating';\nimport { focusOn, focusWithin, getActiveElement } from '../utils/PRIVATE_tabbableUtils';\nimport { mergeRefs } from '../utils/PRIVATE_refUtils';\nimport { FocusTrap } from '../UNSAFE_FocusTrap';\nimport { Layer } from '../UNSAFE_Layer';\nimport { forwardRef, ForwardedRef } from 'preact/compat';\nimport { HTMLAttributesSignalExcluded } from '../utils/UNSAFE_attributeUtils';\nimport { usePopupAnimation } from './usePopupAnimation';\n\n// Style imports\nimport { useComponentTheme } from '../hooks/UNSAFE_useComponentTheme';\nimport { popupVars } from './themes/PopupContract.css';\nimport { getVarName } from '../utils/UNSAFE_stringUtils';\nimport { Property } from 'csstype';\nimport { classNames } from '../utils/UNSAFE_classNames';\nimport { PopupRedwoodTheme } from './themes/redwood/PopupTheme';\n\ntype IntrinsicProps = Pick<JSX.HTMLAttributes<HTMLDivElement>, 'children'>;\n\ntype Props = IntrinsicProps & {\n  /**\n   * Specifies whether the Popup is open.\n   */\n  isOpen: boolean;\n  /**\n   * Specifies Popup's anchor. Popup is placed relatively to its anchor.\n   */\n  anchorRef: RefObject<HTMLElement | Coords>;\n  /**\n   * Specifies placement of the Popup relative to the anchor.\n   */\n  placement?: Placement;\n  /**\n   * Specifies displacement of the Popup from the anchor element placement along the specified axes.\n   * The offset object consists of mainAxis and crossAxis properties. The direction in which these properties\n   * are applied depends on the current value of the position property.\n   *\n   * The <code>mainAxis</code> property represents the distance between the Popup and the anchor.\n   * The <code>crossAxis</code> property represents the deviation in the opposite axis to the main axis - the skidding between the Popup and the anchor.\n   */\n  offset?: Offset;\n  /**\n   * Specifies whether a floating Popup changes placement to the opposite side to be kept in view when a collision is detected.\n   *\n   * The flipOptions object consists of mainAxis and crossAxis properties.\n   * The <code>mainAxis</code> runs along the side of the Popup element.\n   * The <code>crossAxis</code> runs along the alignment of the Popup element.\n   */\n  flipOptions?: FlipOptions;\n  /**\n   * Specifies whether a floating Popup shifts along axis to be kept in view when a collision is detected.\n   * Note that if both 'flip' and 'shift' are enabled on respective axis, the flip will take precedence.\n   *\n   * The shiftOptions object consists of mainAxis and crossAxis properties.\n   * The <code>mainAxis</code> runs along the side of the Popup element.\n   * The <code>crossAxis</code> runs along the alignment of the Popup element.\n   */\n  shiftOptions?: ShiftOptions;\n  /**\n   * Specifies if the Popup sets focus to its content when initially open.\n   * A value of none prevents the popup from setting focus when open.\n   *\n   * <code>auto</code> in modeless mode resolves to none.\n   * <code>none</code> prevents the popup from setting focus when open.\n   * <code>popup</code> sets focus to the root popup container (good choice for touch platforms).\n   * <code>firstFocusable</code> defines that a popup should set focus to the first focusable element within the popup's content.\n   */\n  initialFocus?: 'auto' | 'none' | 'popup' | 'firstFocusable';\n  /**\n   * Specifies callback triggered when a user clicks outside Popup.\n   */\n  onClickOutside?: (event: MouseEvent) => void;\n  /**\n   * Specifies callback triggered when a user tries to close a Popup through UI interaction.\n   * The parent should listen to this event and close the Popup. If the parent fails to remove\n   * the Popup, then no change will be done in the UI by the component.\n   */\n  onClose?: (event: KeyboardEvent) => void;\n  /**\n   * Specifies Popup's tail. Simple tail is an arrow pointing to Popup's anchor.\n   */\n  tail?: 'none' | 'simple';\n  /**\n   * Specifies callback triggered after the animation ends.\n   */\n  onTransitionEnd?: (value: boolean) => void;\n  /**\n   * Specifies the ARIA role type. Depending on how the popup is used in the page, the page developer should choose from the following:\n   * <code>tooltip</code> defines contextual popup that displays a description for an element. This is added automatically if not already specified.\n   * <code>dialog</code> defines an application window that is designed to interrupt the current processing of an application in order to prompt the user to enter information or require a response.\n   * <code>alertdialog</code> defines type of dialog that contains an alert message, where initial focus goes to an element within the dialog.\n   */\n  role?: HTMLAttributesSignalExcluded['role'];\n};\n\n/**\n * A popup temporarily 'pops up' content in the foreground.\n */\nexport const Popup = forwardRef(\n  (\n    {\n      anchorRef,\n      children,\n      isOpen = false,\n      offset = { mainAxis: 0, crossAxis: 0 },\n      flipOptions = { mainAxis: true, crossAxis: true },\n      shiftOptions = { mainAxis: false, crossAxis: false },\n      onClose,\n      initialFocus = 'auto',\n      onClickOutside,\n      placement = 'top',\n      tail = 'none',\n      onTransitionEnd,\n      role = 'tooltip'\n    }: Props,\n    ref: ForwardedRef<HTMLElement | null>\n  ) => {\n    const [trapDisabled, setTrapDisabled] = useState<boolean>(true);\n    const launcherRef = useRef<HTMLElement | null>(null);\n    const [popupBgColor, setPopupBgColor] = useState<Property.BackgroundColor>();\n\n    const contentWrapperRef = useRef<HTMLDivElement | null>(null);\n\n    //The animationPlacement is used for the case of flip.\n    const [animationPlacement, setAnimationPlacement] = useState<Placement>(placement);\n\n    function launcherKeyDownCallback(event: KeyboardEvent): void {\n      if (launcherRef.current === getActiveElement() && event.code === 'F6') {\n        // Prevent default F6 handlers.\n        // F6 is a standard Chrome address bar shortcut on Windows.\n        event.preventDefault();\n        event.stopPropagation();\n\n        focusWithin(contentWrapperRef.current as HTMLElement);\n      }\n    }\n\n    const _onTransitionEnd = (isOpen: boolean) => {\n      if (isOpen) {\n        setInitialFocus();\n        onTransitionEnd?.(true);\n      } else {\n        onTransitionEnd?.(false);\n      }\n    };\n\n    // Animation\n    const { setAnimationElementRef, status } = usePopupAnimation({\n      isOpen,\n      isAnimatedOnMount: true,\n      onTransitionEnd: _onTransitionEnd,\n      placement: animationPlacement\n    });\n    const stableRef = useMemo(\n      () => mergeRefs(setAnimationElementRef, ref),\n      [setAnimationElementRef, ref]\n    );\n\n    const returnFocus = () => {\n      // Try to return focus to 1.launcher or 2.anchor\n      const launcherEl = launcherRef.current;\n      const anchorEl = anchorRef.current;\n\n      if (launcherEl) {\n        focusOn(launcherEl);\n        // Checking instanceof to avoid Coords type that can not be focused\n      } else if (anchorEl && anchorEl instanceof Element) {\n        focusOn(anchorEl);\n      }\n    };\n    useEffect(() => {\n      // Init closing\n      if (!isOpen && status === 'opening') {\n        // Only actively return focus to the launcher or anchor if the popup contained focus.\n        // Otherwise, focus is already elsewhere on the page and should not be forced back\n        // because that could reopen the popup again, which essentially prevents the user from\n        // moving focus out of the launcher.\n        if (contentWrapperRef.current?.contains(getActiveElement())) {\n          returnFocus();\n        }\n      }\n    }, [isOpen, status]);\n\n    // Launcher handler\n    useEffect(() => {\n      if (isOpen && anchorRef.current instanceof Element) {\n        // Remember launcher\n        if (getActiveElement() === document.body) {\n          launcherRef.current = anchorRef.current as HTMLElement;\n        } else {\n          launcherRef.current = getActiveElement();\n        }\n\n        // Register F6 key handler to enter the Popup\n        launcherRef.current?.addEventListener('keydown', launcherKeyDownCallback);\n      }\n      return () => {\n        // Deregister F6 key handler\n        launcherRef.current?.removeEventListener('keydown', launcherKeyDownCallback);\n      };\n    }, [isOpen]);\n\n    const setInitialFocus = () => {\n      let derivedInitialFocus = initialFocus;\n      if (initialFocus === 'auto') {\n        // Modeless mode - do not steal focus by default\n        derivedInitialFocus = 'none';\n      }\n\n      // Case: 'popup'\n      // Focus on Popup container\n      if (derivedInitialFocus === 'popup') {\n        focusOn(contentWrapperRef.current as HTMLElement);\n      }\n\n      // Case: 'firstFocusable'\n      // Focus on first tabbable in the Popup container or container itself if there is none\n      if (derivedInitialFocus === 'firstFocusable') {\n        focusWithin(contentWrapperRef.current as HTMLElement);\n      }\n    };\n\n    const getMainAxisOffset = (offset?: Offset) => {\n      let calcOffset = 0;\n      if (offset) {\n        // @ts-ignore as OffsetFunction is going to be removed\n        // Property 'mainAxis' does not exist on type 'OffsetFunction'.\n        calcOffset = typeof offset === 'number' ? offset : offset.mainAxis || 0;\n        if (tail === 'simple') {\n          calcOffset += 5;\n        }\n      }\n      return calcOffset;\n    };\n\n    const getCrossAxisOffset = (offset?: Offset) => {\n      if (!offset) {\n        return 0;\n      } else {\n        // @ts-ignore as OffsetFunction is going to be removed\n        // Property 'crossAxis' does not exist on type 'OffsetFunction'.\n        return typeof offset === 'number' ? 0 : offset.crossAxis || 0;\n      }\n    };\n\n    const finalOffset = {\n      mainAxis: getMainAxisOffset(offset),\n      crossAxis: getCrossAxisOffset(offset)\n    };\n\n    // Preact FocusEvent mapping\n    // onFocus - focusin\n    // onBlur - focusout\n    //\n    // https://developer.mozilla.org/en-US/docs/Web/API/FocusEvent/relatedTarget\n    // Event name   target                           relatedTarget\n    // blur         The EventTarget losing focus     The EventTarget receiving focus (if any).\n    // focus        The EventTarget receiving focus  The EventTarget losing focus (if any)\n    // focusin      The EventTarget receiving focus  The EventTarget losing focus (if any)\n    // focusout     The EventTarget losing focus     The EventTarget receiving focus (if any)\n    const handleOnFocus = (event: FocusEvent) => {\n      // Executing this listener means that element receiving focus lives within Popup.\n      // We are checking which element is loosing focus to avoid activating FocusTrap when focus\n      // travels among elements within FocusTrap.\n      // To enable FocusTrap the element that looses focus must live out of the Popup or is Popup's container.\n      if (\n        !contentWrapperRef.current?.contains(event.relatedTarget as Element) ||\n        event.relatedTarget === contentWrapperRef.current\n      ) {\n        // Do not activate focusTrap if the event.target is Popup itself - if we clicked on Popup's container\n        // We should be able to focus Popup container without activating FocusTrap\n        if (event.target != contentWrapperRef.current) {\n          // Enable FocusTrap.\n          setTrapDisabled(false);\n        }\n      }\n    };\n    const handleOnBlur = (event: FocusEvent) => {\n      // Executing this listener means that an element living within Popup is loosing focus.\n      // We are checking which element is receiving focus to avoid disabling FocusTrap when focs\n      // travels among elements within FocusTrap.\n      // To disable FocusTrap element the element that receives focus must live out of the Popup or is Popup's container.\n      if (\n        !contentWrapperRef.current?.contains(event.relatedTarget as Element) ||\n        event.relatedTarget === contentWrapperRef.current\n      ) {\n        // Disable FocusTrap.\n        setTrapDisabled(true);\n      }\n    };\n\n    const handlePopupKeyDown = (event: KeyboardEvent) => {\n      const currentlyFocusedEl = getActiveElement();\n      const wrapperEl = contentWrapperRef.current;\n      const launcherEl = launcherRef.current;\n      if (wrapperEl === currentlyFocusedEl || wrapperEl?.contains(currentlyFocusedEl)) {\n        switch (event.code) {\n          case 'Escape': {\n            onClose?.(event);\n            break;\n          }\n          case 'F6':\n            // Prevent default F6 handlers.\n            // F6 is a standard Chrome address bar shortcut on Windows.\n            event.preventDefault();\n            event.stopPropagation();\n\n            // Focus launcher\n            if (launcherEl) {\n              focusOn(launcherEl);\n            }\n            // Disable FocusTrap\n            setTrapDisabled(true);\n            break;\n          case 'Tab':\n            // If tabbing out of the popup when the popup itself has focus and the focus trap is\n            // disabled, transfer focus back to the launcher.  Don't let the browser then\n            // transfer focus itself from there like it normally would.\n            if (event.target === contentWrapperRef.current && trapDisabled) {\n              // Focus launcher\n              if (launcherEl) {\n                focusOn(launcherEl);\n\n                // Prevent the browser from transferring focus itself.\n                event.preventDefault();\n              }\n            }\n            break;\n        }\n      }\n    };\n\n    const onPosition = useCallback(\n      (data: PositionData) => {\n        if (placement !== data.placement) {\n          //if flips happens we need to change the placement in the animations.\n          setAnimationPlacement(data.placement);\n        }\n      },\n      [setAnimationPlacement, placement]\n    );\n\n    useLayoutEffect(() => {\n      if (\n        status === 'unmounted' ||\n        contentWrapperRef.current == null ||\n        popupBgColor != null ||\n        tail === 'none'\n      )\n        return;\n\n      const backgroundColorVar = getVarName(popupVars.backgroundColor);\n      const computedStyle = getComputedStyle(contentWrapperRef.current!);\n      setPopupBgColor(computedStyle.getPropertyValue(backgroundColorVar));\n    }, [status, contentWrapperRef, popupBgColor, tail]);\n\n    // Styles\n    const { baseTheme, classes } = useComponentTheme(PopupRedwoodTheme);\n    const isMounted = status !== 'unmounted';\n    return (\n      isMounted && (\n        <Layer>\n          <Floating\n            ref={stableRef}\n            backgroundColor={popupBgColor}\n            anchorRef={anchorRef}\n            placement={placement}\n            offsetValue={finalOffset}\n            flipOptions={flipOptions}\n            shiftOptions={shiftOptions}\n            onClickOutside={onClickOutside}\n            tail={tail}\n            onPosition={onPosition}>\n            <div\n              ref={contentWrapperRef}\n              tabIndex={-1}\n              role={role}\n              className={classNames([baseTheme, classes])}\n              onFocus={handleOnFocus}\n              onBlur={handleOnBlur}\n              onKeyDown={handlePopupKeyDown}>\n              {/*Setting restoreFocusRef to false because otherwise FocusTrap is stealing the focus back when :*/}\n              {/*we click outside of modeless Popup (that keeps being open).*/}\n              <FocusTrap isDisabled={trapDisabled} restoreFocusRef={false}>\n                {children}\n              </FocusTrap>\n            </div>\n          </Floating>\n        </Layer>\n      )\n    );\n  }\n);\n"],"names":["_jsx"],"mappings":"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"}