{"version":3,"file":"clientHints-26cce6ec.js","sources":["../../src/utils/PRIVATE_clientHints/clientHints.ts"],"sourcesContent":["// Typescript does not support NavigatorUAData in its DOM lib,\n// therefore we declare our own type - see:\n//    https://wicg.github.io/ua-client-hints/#interface\ntype NavigatorUAData = {\n  brands: Array<{ brand: string; version: string }>;\n  mobile: boolean;\n  platform: string;\n};\n\n// Enum types\ntype ClientBrowser = 'chrome' | 'edge' | 'firefox' | 'safari' | 'unknown';\n\ntype ClientDeviceType = 'phone' | 'tablet' | 'unknown';\n\ntype ClientPlatform = 'android' | 'ios' | 'mac' | 'windows' | 'unknown';\n\ntype ClientTouchSupport = 'none' | 'primary' | 'secondary' | 'unknown';\n\ntype ClientHoverSupport = 'none' | 'pseudo-classes' | 'events' | 'unknown';\n\nexport type ClientHints = {\n  browser: ClientBrowser;\n  browserMajorVersion: number;\n  deviceType: ClientDeviceType;\n  platform: ClientPlatform;\n  touchSupport: ClientTouchSupport;\n  hoverSupport: ClientHoverSupport;\n};\n\nconst defaultClientHints: ClientHints = {\n  browser: 'unknown',\n  browserMajorVersion: -1,\n  deviceType: 'unknown',\n  platform: 'unknown',\n  touchSupport: 'unknown',\n  hoverSupport: 'unknown'\n};\n\nlet cachedClientHints: ClientHints;\n\nexport function getClientHints(uaString?: string): Readonly<ClientHints> {\n  // Compute if there is no cached result, OR if a userAgent string\n  //  was passed in as an argument\n  if (cachedClientHints === undefined || uaString) {\n    let hints: ClientHints;\n    const userAgentData =\n      typeof navigator !== 'undefined' && ((navigator as any)['userAgentData'] as NavigatorUAData);\n    if (userAgentData) {\n      hints = getHintsFromUserAgentData(userAgentData);\n    } else {\n      hints = getHintsFromUserAgentString(\n        uaString ?? (typeof navigator !== 'undefined' ? navigator.userAgent : '')\n      );\n    }\n\n    // If no argument was passed in then this was computed from Navigator properties:\n    //    * determine touchSupport, hoverSupport\n    //    * cache the results\n    if (uaString === undefined) {\n      // NOTE:  Order is important (determination of hoverSupport depends upon touchSupport)\n      determineTouchSupport(hints);\n      determineHoverSupport(hints);\n      cachedClientHints = { ...hints };\n      Object.freeze(cachedClientHints);\n    }\n    // Otherwise, return the one-off User-Agent string results without touching the cache\n    else {\n      return hints;\n    }\n  }\n  return cachedClientHints;\n}\n\nfunction getHintsFromUserAgentData(userAgentData: NavigatorUAData): Readonly<ClientHints> {\n  const hints = { ...defaultClientHints };\n\n  // Loop through brands => browser, browserMajorVersion\n  for (const item of userAgentData.brands) {\n    const brand = item.brand.toLowerCase();\n    if (brand.indexOf('chrome') > -1) {\n      hints.browser = 'chrome';\n    } else if (brand.indexOf('edge') > -1) {\n      hints.browser = 'edge';\n    }\n    if (hints.browser !== 'unknown') {\n      hints.browserMajorVersion = Number(item.version);\n      break;\n    }\n  }\n\n  // Set deviceType, platform\n  const platform = userAgentData.platform.toLowerCase();\n  if (platform === 'windows') {\n    hints.platform = 'windows';\n  } else if (platform === 'android') {\n    hints.platform = 'android';\n    hints.deviceType = userAgentData.mobile ? 'phone' : 'tablet';\n  } else if (platform === 'macos') {\n    hints.platform = 'mac';\n  }\n  // TODO: Verify userAgentData support in Chrome 100 on iPhone/iPad when available\n  /*\n  else if (platform.indexOf('iphone') > -1) {\n    hints.platform = 'ios';\n    hints.deviceType = 'phone';\n  } else if (platform.indexOf('ipad') > -1) {\n    hints.platform = 'ios';\n    hints.deviceType = 'tablet';\n  } else if (platform.indexOf('ios') > -1) {\n    hints.platform = 'ios';\n    hints.deviceType = (userAgentData.mobile ? 'phone' : 'tablet');\n  }\n  */\n  return hints;\n}\n\nfunction getHintsFromUserAgentString(userAgent: string): Readonly<ClientHints> {\n  const hints = { ...defaultClientHints };\n\n  // Normalize the userAgent string\n  userAgent = userAgent.toLowerCase();\n\n  // Check platform, deviceType\n  if (userAgent.indexOf('iphone') > -1) {\n    hints.platform = 'ios';\n    hints.deviceType = 'phone';\n  } else if (\n    userAgent.indexOf('ipad') > -1 ||\n    // handle iPad/iPhone safari requesting desktop version of site\n    (userAgent.indexOf('macintosh') > -1 && navigator?.maxTouchPoints > 0)\n  ) {\n    hints.platform = 'ios';\n    hints.deviceType = 'tablet';\n  } else if (userAgent.indexOf('mac') > -1) {\n    hints.platform = 'mac';\n  } else if (userAgent.indexOf('android') > -1) {\n    hints.platform = 'android';\n  } else if (userAgent.indexOf('win') > -1) {\n    hints.platform = 'windows';\n  }\n\n  // Now work on browser, browserMajorVersion\n  if (userAgent.indexOf('edg') > -1) {\n    hints.browser = 'edge';\n    hints.browserMajorVersion = parseMajorVersion(userAgent, /edg\\/(\\d+)/);\n  } else if (userAgent.indexOf('chrome') > -1) {\n    hints.browser = 'chrome';\n    hints.browserMajorVersion = parseMajorVersion(userAgent, /chrome\\/(\\d+)/);\n  } else if (userAgent.indexOf('crios') > -1) {\n    hints.browser = 'chrome';\n    hints.browserMajorVersion = parseMajorVersion(userAgent, /crios\\/(\\d+)/);\n  } else if (userAgent.indexOf('fxios') > -1) {\n    hints.browser = 'firefox';\n    hints.browserMajorVersion = parseMajorVersion(userAgent, /fxios\\/(\\d+)/);\n  } else if (userAgent.indexOf('firefox') > -1) {\n    hints.browser = 'firefox';\n    hints.browserMajorVersion = parseMajorVersion(userAgent, /rv:(\\d+)/);\n  } else if (userAgent.indexOf('safari') > -1) {\n    hints.browser = 'safari';\n    hints.browserMajorVersion = parseMajorVersion(userAgent, /version\\/(\\d+)/);\n  }\n\n  return hints;\n}\n\nfunction parseMajorVersion(userAgent: string, majorVersionPattern: RegExp): number {\n  let majorVer;\n  const matches = userAgent.match(majorVersionPattern);\n  if (matches) {\n    const majorVerString = matches[1];\n    if (majorVerString) {\n      majorVer = parseInt(majorVerString);\n    }\n  }\n  return majorVer ?? -1;\n}\n\nfunction determineTouchSupport(hints: ClientHints): void {\n  // if no global window object, or if ontouchstart handler not supported & no touch points,\n  // then no touch support\n  if (\n    typeof window === 'undefined' ||\n    (!('ontouchstart' in window) && navigator.maxTouchPoints === 0)\n  ) {\n    hints.touchSupport = 'none';\n  }\n  // otherwise if primary input pointer is 'coarse', then touch is the primary input method\n  else if (window.matchMedia?.('(pointer: coarse)').matches) {\n    hints.touchSupport = 'primary';\n  }\n  // otherwise if ANY input pointer is 'coarse', then touch is a secondary input method\n  else if (window.matchMedia?.('(any-pointer: coarse)').matches) {\n    hints.touchSupport = 'secondary';\n  }\n\n  // NOTES:\n  //  - Pixel 7 devices have a bug (https://bugs.chromium.org/p/chromium/issues/detail?id=1384181) whereby\n  //    ALL pointer media queries return 'fine', causing us to report hints.touchSupport as 'unknown'.\n}\n\nfunction determineHoverSupport(hints: ClientHints): void {\n  // if no global window object, or if primary input does not support hover, then specify no hover support\n  if (typeof window === 'undefined' || window.matchMedia?.('(hover: none)').matches) {\n    hints.hoverSupport = 'none';\n  }\n  // otherwise primary input must support hover - if there is some level of touch support and the primary\n  // input pointer is 'fine' (indicating the presence of a hover-able pointer), then component code\n  // should use event listeners to implement hover support\n  else if (hints.touchSupport !== 'none' && window.matchMedia?.('(pointer: fine)').matches) {\n    hints.hoverSupport = 'events';\n  }\n  // otherwise specify that component code can assume native CSS support for hover\n  else {\n    hints.hoverSupport = 'pseudo-classes';\n  }\n}\n"],"names":[],"mappings":"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"}