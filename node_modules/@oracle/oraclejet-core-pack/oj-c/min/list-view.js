define("oj-c/utils/UNSAFE_keyUtils/keySetUtils",["require","exports","ojs/ojkeyset"],(function(require,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.keysToKeySet=e.keySetToKeys=void 0;e.keySetToKeys=e=>{if(!e)return{all:!1,keys:new Set};let t={};if(e.isAddAll()){t={all:!0,deletedKeys:new Set(e.deletedValues())}}else if(!e.isAddAll()){t={all:!1,keys:new Set(e.values())}}return t};e.keysToKeySet=e=>{let s;return e.all?(s=new t.AllKeySetImpl,s=s.delete(new Set(e.deletedKeys.values()))):e.all||(s=new t.KeySetImpl(new Set(e.keys.values()))),s}})),define("oj-c/hooks/UNSAFE_useListData/useListData",["require","exports","ojs/ojdataproviderfactory","preact/hooks"],(function(require,e,t,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.useListData=void 0;const a=Object.freeze({status:"loading",data:null}),r={isInitialFetchDeferred:!1};e.useListData=(e,t=r)=>{const l=(0,s.useRef)(null),y=(0,s.useRef)(0),h=(0,s.useRef)(!1),p=(0,s.useRef)(null),m=(0,s.useRef)(null),b=t.fetchSize&&t.fetchSize>0?t.fetchSize:25;if(!e){return[c("exact"),e=>Promise.resolve()]}const v=(0,s.useMemo)((()=>i(e)),[e]),[g,S]=(0,s.useReducer)(n,a),j=(0,s.useCallback)((async(e,s)=>{const a={attributes:t.attributes,sortCriteria:t.sortCriteria,filterCriterion:t.filterCriterion,offset:e.offset,size:e.count},r=!0===h.current?"exact":"atLeast";if(0!==e.count)try{const t=(await v.fetchByOffset(a)).results;s&&s(t),S({status:"success",data:{offset:e.offset,data:t,totalSize:y.current,sizePrecision:r}})}catch(e){S({status:"error",error:e})}else S({status:"success",data:{offset:e.offset,data:[],totalSize:y.current,sizePrecision:r}})}),[v,t.attributes,t.filterCriterion,t.sortCriteria]),w=(0,s.useCallback)((async()=>{S({status:"loading",data:null});const e=new AbortController;m.current=e;const s=v.fetchFirst({attributes:t.attributes,sortCriteria:t.sortCriteria,filterCriterion:t.filterCriterion,size:b,signal:e.signal})[Symbol.asyncIterator]();p.current=s;try{const e=await s.next(),a=e.value.fetchParameters;if(a.signal&&a.signal.aborted)return;y.current=e.value.data.length,void 0!==e.done&&(h.current=e.done);const r=t.initialRowsFetched&&t.initialRowsFetched>0?t.initialRowsFetched:b;j({offset:0,count:Math.min(y.current,r)})}catch(e){if(e instanceof DOMException&&"AbortError"===e.name)return;S({status:"error",error:e}),p.current=null}}),[v,j,t.attributes,t.filterCriterion,t.sortCriteria,t.fetchSize]),k=(0,s.useCallback)((async e=>{if(null===p.current)w();else{const t=e.offset+e.count;if(t>y.current){if(null==l.current){const s=o(p,y.current,t);l.current=s;try{const t=await s;void 0!==t.done&&(h.current=t.done);const a=t.total;a>0&&(y.current=a,j({offset:e.offset,count:Math.min(y.current-e.offset,e.count)})),l.current=null}catch(e){S({status:"error",error:e}),l.current=null}}}else j(e)}}),[g,w,j]),C=(0,s.useCallback)((()=>{p.current=null,l.current=null,y.current=0,h.current=!1,0===t.initialRowsFetched?S(c("atLeast")):t.isInitialFetchDeferred?S({status:"loading",data:null}):w()}),[w,t.isInitialFetchDeferred,t.initialRowsFetched]);(0,s.useEffect)((()=>{C()}),[C]);const _=(0,s.useCallback)((e=>{if("success"===g.status&&g.data){const s=g.data;let a,r=!1;if(e.detail.add){const a=u(e.detail.add,s,t,!0);y.current=y.current+a,r=a>0||"exact"===s.sizePrecision,0===a&&(h.current=!1)}if(e.detail.remove){const a=u(e.detail.remove,s,t,!1);y.current=y.current-a,r=r||a>0}const i=e.detail.update;i&&(r=r||d(i,s,t),a=e=>{f(i,s,e)}),r&&j({offset:s.offset,count:s.data.length},a)}}),[g,t,j]),x=(0,s.useCallback)((e=>{let t=-1;const s=e.detail?.disregardAfterKey;if(s&&"success"===g.status){const e=g.data.data.findIndex((e=>e.metadata.key===s));if(e>-1&&(t=g.data.data.length-e-1),0===t&&g.data.data.length>=b)return}t>-1&&"success"===g.status?(y.current=y.current-t,k({offset:g.data.offset,count:Math.max(g.data.data.length,b)})):("loading"===g.status&&m.current?.abort(),C())}),[g,C]);return(0,s.useEffect)((()=>(v.addEventListener("refresh",x),v.addEventListener("mutate",_),()=>{v.removeEventListener("refresh",x),v.removeEventListener("mutate",_)})),[v,C,_]),[g,k]};const i=e=>(0,t.getEnhancedDataProvider)(e,{fetchFirst:{caching:"visitedByCurrentIterator"}}),n=(e,t)=>e.status===t.status&&"loading"===t.status?e:t,o=async(e,t,s)=>await l(e,t,s),l=async(e,t,s)=>{const a=e.current;if(null===a)return{total:-1,done:void 0};const r=await a.next();return a===e.current?(t+=r.value.data.length)>=s||r.done?{total:t,done:r.done}:l(e,t,s):{total:-1,done:void 0}},c=e=>({status:"success",data:{offset:0,data:[],totalSize:0,sizePrecision:e}}),u=(e,t,s,a)=>{let r=0;if(y(e,s)){const s=a?e.indexes?.sort():e.indexes;let i=t.totalSize-1;s?.forEach((e=>{e<=i&&(r=r+=1,a&&(i=i+=1))}))}return r},d=(e,t,s)=>{if(y(e,s)){const s=e.indexes?e.indexes:[],a=t.offset,r=a+t.data.length;for(let e=0;e<s.length;e++)if(s[e]>=a&&s[e]<r)return!0}return!1},f=(e,t,s)=>{e.keys.forEach((e=>{const a=s.find((t=>t.metadata.key==e)),r=t.data.find((t=>t.metadata.key==e));r&&a&&r.data===a.data&&(a.data=new Proxy(a.data,{}))}))},y=(e,t)=>e.indexes&&null==t.sortCriteria&&null==t.filterCriterion})),define("oj-c/list-view/useListViewPreact",["require","exports","preact/hooks","../utils/UNSAFE_keyUtils/keySetUtils","../hooks/UNSAFE_useListData/useListData"],(function(require,e,t,s,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.useListViewPreact=void 0;e.useListViewPreact=({"aria-label":e,"aria-labelledby":r,data:i,gridlines:n,onCurrentItemChanged:o,selectionMode:l,selected:c,scrollPolicyOptions:u,onSelectedChanged:d,onOjItemAction:f},y,h)=>{const p=(0,t.useRef)(),[m,b]=(0,a.useListData)(i,{fetchSize:u?.fetchSize}),v=(0,s.keySetToKeys)(c),g="error"!==m.status?m.data:null,[S,j]=(0,t.useState)();(0,t.useEffect)((()=>{"loading"===m.status?p.current=y("list data is in fetch state"):p.current&&(p.current(),p.current=void 0)}),[m.status]);const w=u?.scroller?{scroller:()=>u.scroller?document.querySelector(u.scroller):null}:void 0,k=(0,t.useMemo)((()=>function(e){if("success"!==e.status)return{count:0};const t=e.data.data;let s=0;for(let e=0;e<t.length&&null!=t[e].metadata.suggestion;e++)s+=1;return{count:s}}(m)),[m]),C=(0,t.useCallback)((()=>{if(g){const e=u&&u.fetchSize?u.fetchSize:25;b({offset:0,count:g.data.length+e})}}),[m,u,b]);return{status:m.status,listViewProps:{"aria-label":e,"aria-labelledby":r,data:g?g.data:null,currentKey:S,getRowKey:e=>e.metadata.key,gridlines:n,onCurrentKeyChange:e=>{j(e.value),o&&o(e.value)},hasMore:!!g&&"atLeast"===g.sizePrecision,onLoadMore:C,onSelectionChange:e=>{d&&!h(e.target)&&d((0,s.keysToKeySet)(e.value))},selectedKeys:v,selectionMode:l,promotedSection:k,onItemAction:e=>{const t=e.context.data,s={context:{item:t,data:t.data}};f&&f(s)},viewportConfig:w}}}})),define("oj-c/list-view/listViewItem",["require","exports","preact/jsx-runtime","@oracle/oraclejet-preact/hooks/UNSAFE_useTabbableMode","@oracle/oraclejet-preact/hooks/UNSAFE_useTranslationBundle"],(function(require,e,t,s,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ListItem=void 0;e.ListItem=({context:e,itemTemplate:r})=>{const{isTabbable:i}=(0,s.useTabbableMode)(),n=(0,a.useTranslationBundle)("@oracle/oraclejet-preact"),o={isTabbable:i,data:e.data.data,item:e.data};return(0,t.jsxs)(s.TabbableModeContext.Provider,{value:{isTabbable:i},children:[r&&r(o),o.item.metadata?.suggestion&&(0,t.jsx)("span",{class:"oj-helper-hidden-accessible",children:n.list_suggestion()})]})}}));var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("oj-c/list-view/list-view",["require","exports","preact/jsx-runtime","@oracle/oraclejet-preact/translationBundle","ojs/ojcontext","ojs/ojvcomponent","preact/compat","preact/hooks","@oracle/oraclejet-preact/UNSAFE_EmptyList","@oracle/oraclejet-preact/UNSAFE_ListView","@oracle/oraclejet-preact/hooks/UNSAFE_useTranslationBundle","./useListViewPreact","./listViewItem","css!oj-c/list-view/list-view-styles.css"],(function(require,e,t,s,a,r,i,n,o,l,c,u,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ListView=void 0,s=__importDefault(s),a=__importDefault(a);const f=({addBusyState:e,isClickthroughDisabled:s,itemTemplate:a,noData:r,...n})=>{const{status:f,listViewProps:y}=(0,u.useListViewPreact)(n,e,s),h=(0,c.useTranslationBundle)("@oracle/oraclejet-preact");if("success"===f&&!y.hasMore&&0===y.data?.length){if(r)return(0,t.jsx)(o.EmptyList,{children:r(i.Children)});{const e=h.noData_message();return(0,t.jsx)(o.EmptyList,{children:e})}}return(0,t.jsx)(l.ListView,{...y,children:e=>(0,t.jsx)(d.ListItem,{context:e,itemTemplate:a})})};e.ListView=(0,r.registerCustomElement)("oj-c-list-view",(({selectionMode:e="none",...s})=>{const i=(0,n.useRef)(),o=(0,n.useRef)(a.default.getContext(i.current).getBusyContext()),l=(0,n.useCallback)((e=>o.current?.addBusyState({description:`oj-c-list-view: ${e}`})),[]),c=(0,n.useCallback)((e=>null!==e&&void 0!==i.current&&y({target:e},i.current)),[]),u={selectionMode:e,...s};return(0,t.jsx)(r.Root,{id:u.id,ref:i,children:(0,t.jsx)(f,{addBusyState:l,isClickthroughDisabled:c,...u})})}),"ListView",{properties:{currentItem:{type:"any",readOnly:!0,writeback:!0},data:{type:"DataProvider|null"},gridlines:{type:"object",properties:{item:{type:"string",enumValues:["hidden","visible"]},top:{type:"string",enumValues:["hidden","visible"]},bottom:{type:"string",enumValues:["hidden","visible"]}}},scrollPolicyOptions:{type:"object",properties:{fetchSize:{type:"number"},scroller:{type:"string"}}},selected:{type:"object",writeback:!0},selectionMode:{type:"string",enumValues:["multiple","none","single"]}},slots:{itemTemplate:{data:{}},noData:{data:{}}},events:{ojItemAction:{}},extension:{_WRITEBACK_PROPS:["currentItem","selected"],_READ_ONLY_PROPS:["currentItem"],_OBSERVED_GLOBAL_PROPS:["aria-label","aria-labelledby","id"]}},{selectionMode:"none"},{"@oracle/oraclejet-preact":s.default});const y=function(e,t){let s=e.target;for(;null!=s&&s!==t;){if(h(s))return!0;s=s.parentNode}return!1},h=function(e){return"disabled"===e.dataset.ojClickthrough}}));
//# sourceMappingURL=list-view.js.map