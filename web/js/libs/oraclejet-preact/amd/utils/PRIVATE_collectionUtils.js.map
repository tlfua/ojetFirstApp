{"version":3,"file":"PRIVATE_collectionUtils.js","sources":["../../../src/utils/PRIVATE_collectionUtils/collectionUtils.ts"],"sourcesContent":["import { RefObject } from 'preact';\nimport { ViewportConfig } from '../../hooks/UNSAFE_useViewportIntersect';\nimport { SelectionRangeDetail } from '../../hooks/PRIVATE_useSelection';\nimport { isKeyDefined } from '../UNSAFE_keys';\nimport { getClientHints } from '../PRIVATE_clientHints';\n\n/**\n * Returns the key from the item element\n */\nconst getKey = (item: HTMLElement) => {\n  return item.dataset['ojKeyType'] === 'number'\n    ? Number(item.dataset['ojKey'])\n    : item.dataset['ojKey'];\n};\n\n/**\n * A helper function that return the key of the first available item.\n */\nexport const getFirstVisibleKey = (root: HTMLElement, itemSelector: string) => {\n  if (root) {\n    const firstItem = root.querySelector(itemSelector);\n    if (firstItem) {\n      const key = getKey(firstItem as HTMLElement);\n      return key;\n    }\n  }\n  return null;\n};\n\n/**\n * A helper function to find the element with the specified key.\n * Returns null if the element with key is not found.\n */\nexport const findElementByKey = <K extends string | number>(\n  root: HTMLElement,\n  key: K,\n  itemSelector: string\n) => {\n  if (root) {\n    const items = root.querySelectorAll(itemSelector);\n    for (let i = 0; i < items.length; i++) {\n      const thisKey = getKey(items[i] as HTMLElement);\n      if (key == (thisKey as K)) {\n        return items[i];\n      }\n    }\n  }\n  return null;\n};\n\n/**\n * A helper function that returns the key of the previous or the next item\n * given the specified current key\n */\nexport const getPrevNextKey = <K extends string | number>(\n  root: HTMLElement | null,\n  currentKey: K | undefined,\n  isPrev: boolean,\n  itemSelector: string\n) => {\n  return (): K | null => {\n    if (isKeyDefined(currentKey) && root) {\n      const currItem = findElementByKey(root, currentKey as K, itemSelector);\n      if (currItem) {\n        const nextItem = isPrev ? currItem.previousElementSibling : currItem.nextElementSibling;\n        if (nextItem) {\n          const key = getKey(nextItem as HTMLElement) as K;\n          if (key != null) {\n            return key;\n          }\n        }\n        // no next item or next item is not a valid item\n        return null;\n      }\n      return getFirstVisibleKey(root, itemSelector) as K;\n    }\n    return null;\n  };\n};\n\n/**\n * A helper function that returns the key of the previous or the next item by count,\n * given the specified current key\n */\nexport const getPrevNextKeyByCount = <K, D>(\n  data: D[] | null,\n  getRowKey: (data: D) => K,\n  currentKey?: K,\n  count = 0\n) => {\n  if (data && currentKey != undefined) {\n    const currIndex = data.findIndex((d) => {\n      return getRowKey(d) === currentKey;\n    });\n    const nextIndex = currIndex + count;\n    if (0 <= nextIndex && nextIndex < data.length) {\n      return getRowKey(data[nextIndex]);\n    }\n    return null;\n  }\n  return null;\n};\n\n/**\n * A helper function to get the key from an element\n */\nexport const keyExtractor = <K extends string | number>(\n  element: HTMLElement,\n  itemSelector: string\n): K | null => {\n  const item = element.closest(itemSelector);\n  if (item) {\n    const key = getKey(item as HTMLElement) as K;\n    return key === undefined ? null : key;\n  }\n  return null;\n};\n\n/**\n * A helper function to that return viewPortConfig to collection components\n */\nexport const getViewportConfig = (rootRef: RefObject<HTMLElement>, config?: ViewportConfig) => {\n  return (\n    config ?? {\n      scroller: () => {\n        return rootRef.current;\n      }\n    }\n  );\n};\n\n/**\n * A helper function to handle range selection\n */\nexport const handleSelectionRange = <K, D>(\n  detail: SelectionRangeDetail<K>,\n  data: D[],\n  getRowKey: (data: D) => K\n) => {\n  const keys = data.map((value: D) => {\n    return getRowKey(value);\n  });\n  const startIndex = keys.indexOf(detail.value.start);\n  const endIndex = keys.indexOf(detail.value.end);\n  const minIndex = Math.min(startIndex, endIndex);\n  const maxIndex = Math.max(startIndex, endIndex);\n  if (minIndex === -1) {\n    // return a range to fetch so we can find all the keys, maxIndex should not be -1\n    return { offset: 0, count: -1 };\n  } else {\n    // range of keys are in the current viewport, return them\n    return keys.slice(minIndex, maxIndex + 1);\n  }\n};\n\n/**\n * Helper function to determine whether the current device is a mobile device\n * @returns true if running on a mobile device, false otherwise\n */\nexport function isMobile() {\n  const deviceType = getClientHints().deviceType;\n  return deviceType === 'phone' || deviceType === 'tablet';\n}\n"],"names":["getKey","item","dataset","Number","getFirstVisibleKey","root","itemSelector","firstItem","querySelector","findElementByKey","key","items","querySelectorAll","i","length","currentKey","isPrev","isKeyDefined","currItem","nextItem","previousElementSibling","nextElementSibling","data","getRowKey","count","undefined","nextIndex","findIndex","d","rootRef","config","scroller","current","detail","keys","map","value","startIndex","indexOf","start","endIndex","end","minIndex","Math","min","maxIndex","max","offset","slice","deviceType","getClientHints","element","closest"],"mappings":"qHASA,MAAMA,EAAUC,GACuB,WAA9BA,EAAKC,QAAmB,UAC3BC,OAAOF,EAAKC,QAAe,OAC3BD,EAAKC,QAAe,MAMbE,EAAqB,CAACC,EAAmBC,KACpD,GAAID,EAAM,CACR,MAAME,EAAYF,EAAKG,cAAcF,GACrC,GAAIC,EAAW,CAEb,OADYP,EAAOO,EAEpB,CACF,CACD,OAAO,IAAI,EAOAE,EAAmB,CAC9BJ,EACAK,EACAJ,KAEA,GAAID,EAAM,CACR,MAAMM,EAAQN,EAAKO,iBAAiBN,GACpC,IAAK,IAAIO,EAAI,EAAGA,EAAIF,EAAMG,OAAQD,IAAK,CAErC,GAAIH,GADYV,EAAOW,EAAME,IAE3B,OAAOF,EAAME,EAEhB,CACF,CACD,OAAO,IAAI,+DAOiB,CAC5BR,EACAU,EACAC,EACAV,IAEO,KACL,GAAIW,EAAYA,aAACF,IAAeV,EAAM,CACpC,MAAMa,EAAWT,EAAiBJ,EAAMU,EAAiBT,GACzD,GAAIY,EAAU,CACZ,MAAMC,EAAWH,EAASE,EAASE,uBAAyBF,EAASG,mBACrE,GAAIF,EAAU,CACZ,MAAMT,EAAMV,EAAOmB,GACnB,GAAW,MAAPT,EACF,OAAOA,CAEV,CAED,OAAO,IACR,CACD,OAAON,EAAmBC,EAAMC,EACjC,CACD,OAAO,IAAI,0BAQsB,CACnCgB,EACAC,EACAR,EACAS,EAAQ,KAER,GAAIF,GAAsBG,MAAdV,EAAyB,CACnC,MAGMW,EAHYJ,EAAKK,WAAWC,GACzBL,EAAUK,KAAOb,IAEIS,EAC9B,OAAI,GAAKE,GAAaA,EAAYJ,EAAKR,OAC9BS,EAAUD,EAAKI,IAEjB,IACR,CACD,OAAO,IAAI,sBAqBoB,CAACG,EAAiCC,IAE/DA,GAAU,CACRC,SAAU,IACDF,EAAQG,gCASa,CAClCC,EACAX,EACAC,KAEA,MAAMW,EAAOZ,EAAKa,KAAKC,GACdb,EAAUa,KAEbC,EAAaH,EAAKI,QAAQL,EAAOG,MAAMG,OACvCC,EAAWN,EAAKI,QAAQL,EAAOG,MAAMK,KACrCC,EAAWC,KAAKC,IAAIP,EAAYG,GAChCK,EAAWF,KAAKG,IAAIT,EAAYG,GACtC,OAAkB,IAAdE,EAEK,CAAEK,OAAQ,EAAGvB,OAAQ,GAGrBU,EAAKc,MAAMN,EAAUG,EAAW,EACxC,wBAQD,MAAMI,EAAaC,mBAAiBD,WACpC,MAAsB,UAAfA,GAAyC,WAAfA,CACnC,iBAxD4B,CAC1BE,EACA7C,KAEA,MAAML,EAAOkD,EAAQC,QAAQ9C,GAC7B,GAAIL,EAAM,CACR,MAAMS,EAAMV,EAAOC,GACnB,YAAewB,IAARf,EAAoB,KAAOA,CACnC,CACD,OAAO,IAAI"}