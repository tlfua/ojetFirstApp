{"version":3,"file":"listViewTabbableModeTests-bb646aa6.js","sources":["../../src/PRIVATE_List/__tests__/shared/listViewTabbableModeTests.tsx"],"sourcesContent":["import { fireEvent, render, waitFor } from '@testing-library/preact';\n\nimport type { Employee } from './listViewTestFixtures';\nimport { Metadata } from '../../../UNSAFE_Collection';\nimport { VNode } from 'preact';\nimport { expect } from 'chai';\nimport { getRoot, getContents } from './testHelpers';\nimport { populateData } from './listViewTestFixtures';\nimport userEvent from '@testing-library/user-event';\n\nexport type Props<K> = {\n  data: { data: Employee<K>; metadata: Metadata<K> }[];\n};\n\ntype TestComponentProps<K extends string | number> = (props: Props<K>) => VNode;\n\nexport const testTabbableMode = (TestComponent: TestComponentProps<any>) => {\n  it('acts as single tab stop in composition', async () => {\n    const data = populateData(100, true) as Employee<string>[];\n    const dataMetadata: { data: Employee<string>; metadata: Metadata<string> }[] = data.map(\n      (data) => {\n        return { data: data, metadata: { key: data.id } };\n      }\n    );\n    const list = render(<TestComponent data={dataMetadata} />);\n    const grid = await getRoot(list);\n\n    await userEvent.tab();\n    expect(document.activeElement).equals(list.getByText('Preceding Button'));\n    await userEvent.tab();\n    expect(document.activeElement).equals(grid);\n    await userEvent.tab();\n    expect(document.activeElement).equals(list.getByText('Following Button'));\n    await userEvent.tab({ shift: true });\n    expect(document.activeElement).equals(grid);\n    await userEvent.tab({ shift: true });\n    expect(document.activeElement).equals(list.getByText('Preceding Button'));\n  });\n\n  it('enters interactive mode with keyboard via F2', async () => {\n    const data = populateData(100, true) as Employee<string>[];\n    const dataMetadata: { data: Employee<string>; metadata: Metadata<string> }[] = data.map(\n      (data) => {\n        return { data: data, metadata: { key: data.id } };\n      }\n    );\n    const list = render(<TestComponent data={dataMetadata} />);\n    const grid = await getRoot(list);\n\n    // Tab past first button into ListView\n    await userEvent.tab();\n    await userEvent.tab();\n    expect(document.activeElement).equals(grid);\n\n    list.rerender(<TestComponent data={dataMetadata}></TestComponent>);\n    const firstRowInput = list.getByTestId('input-0');\n    expect(firstRowInput.getAttribute('tabindex')).equals('-1');\n    fireEvent.keyDown(grid, { key: 'F2' });\n    expect(firstRowInput.getAttribute('tabindex')).equals('0');\n  });\n\n  it('leaves interactive mode with keyboard via ESC', async () => {\n    const data = populateData(100, true) as Employee<string>[];\n    const dataMetadata: { data: Employee<string>; metadata: Metadata<string> }[] = data.map(\n      (data) => {\n        return { data: data, metadata: { key: data.id } };\n      }\n    );\n    const list = render(<TestComponent data={dataMetadata} />);\n    const grid = await getRoot(list);\n\n    const firstRowInput = list.getByTestId('input-0');\n    expect(firstRowInput.getAttribute('tabindex')).equals('-1');\n    await userEvent.click(firstRowInput);\n    expect(firstRowInput.getAttribute('tabindex')).equals('0');\n    fireEvent.keyDown(firstRowInput, { key: 'Escape' });\n\n    await waitFor(() => {\n      expect(document.activeElement, 'active element should be grid').equals(grid);\n    });\n  });\n\n  it('enters interactive mode again with keyboard via arrow keys and F2', async () => {\n    const data = populateData(100, true) as Employee<string>[];\n    const dataMetadata: { data: Employee<string>; metadata: Metadata<string> }[] = data.map(\n      (data) => {\n        return { data: data, metadata: { key: data.id } };\n      }\n    );\n    const list = render(<TestComponent data={dataMetadata} />);\n    const grid = await getRoot(list);\n    const items = await getContents(list);\n\n    await userEvent.click(items[0]);\n    fireEvent.keyDown(grid, { key: 'ArrowDown' });\n    const secondRowInput = list.getByTestId('input-1');\n    expect(secondRowInput.getAttribute('tabindex')).equals('-1');\n    fireEvent.keyDown(grid, { key: 'F2' });\n    expect(secondRowInput.getAttribute('tabindex')).equals('0');\n  });\n\n  it('enters interactive mode with click on input', async () => {\n    const data = populateData(100, true) as Employee<string>[];\n    const dataMetadata: { data: Employee<string>; metadata: Metadata<string> }[] = data.map(\n      (data) => {\n        return { data: data, metadata: { key: data.id } };\n      }\n    );\n    const list = render(<TestComponent data={dataMetadata} />);\n\n    const firstRowInput = list.getByTestId('input-0');\n    expect(firstRowInput.getAttribute('tabindex')).equals('-1');\n    await userEvent.click(firstRowInput);\n    // NOTE without this rerender the state change doesn't stick\n    list.rerender(<TestComponent data={dataMetadata}></TestComponent>);\n    expect(firstRowInput.getAttribute('tabindex')).equals('0');\n    expect(document.activeElement).equals(firstRowInput);\n    await userEvent.tab();\n    expect(document.activeElement).equals(list.getByTestId('button-0'));\n  });\n\n  // FIXME: reenable this test once  is fixed\n  xit('leaves interactive mode with click outside', async () => {\n    const data = populateData(100, true) as Employee<string>[];\n    const dataMetadata: { data: Employee<string>; metadata: Metadata<string> }[] = data.map(\n      (data) => {\n        return { data: data, metadata: { key: data.id } };\n      }\n    );\n    const list = render(<TestComponent data={dataMetadata} />);\n\n    const firstRowInput = list.getByTestId('input-0');\n    expect(firstRowInput.getAttribute('tabindex')).equals('-1');\n    await userEvent.click(firstRowInput);\n    // NOTE without this rerender the state change doesn't stick\n    list.rerender(<TestComponent data={dataMetadata} />);\n    expect(firstRowInput.getAttribute('tabindex')).equals('0');\n    expect(document.activeElement).equals(firstRowInput);\n    const outsideElement = list.getByText('Preceding Button');\n    await userEvent.click(outsideElement);\n    expect(document.activeElement).equals(outsideElement);\n    list.rerender(<TestComponent data={dataMetadata} />);\n    expect(firstRowInput.getAttribute('tabindex')).equals('-1');\n  });\n};\n"],"names":["TestComponent","it","async","dataMetadata","populateData","map","data","metadata","key","id","list","render","_jsx","grid","getRoot","userEvent","tab","expect","document","activeElement","equals","getByText","shift","rerender","firstRowInput","getByTestId","getAttribute","fireEvent","keyDown","click","waitFor","items","getContents","secondRowInput","xit","outsideElement"],"mappings":"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"}