define(['exports', 'preact/jsx-runtime', 'preact/hooks', './utils/UNSAFE_mergeProps', './utils/UNSAFE_keys', './utils/PRIVATE_collectionUtils', './hooks/UNSAFE_useId', './hooks/PRIVATE_useCurrentKey', './hooks/PRIVATE_useCollectionFocusRing', './hooks/PRIVATE_useTabbableModeSet', './hooks/PRIVATE_useSelection', './UNSAFE_Grid', './UNSAFE_Selector', './UNSAFE_Skeleton', './SkeletonContainer-ef2d239d', './PRIVATE_LoadMoreCollection', 'preact/compat', './utils/UNSAFE_classNames', './utils/PRIVATE_refUtils', './hooks/UNSAFE_useAnimation', './hooks/UNSAFE_useTabbableMode', './UNSAFE_FocusTrap', './UNSAFE_CardGrid/themes/CardGridStyles.css', './classNames-711dac8e', './useAnimation-95b1d0bd', './FocusTrap-84b5ca93', './LoadMoreCollection-0f3a3fa8', './Skeleton-6e2d8eba'], (function(e,t,i,o,n,s,r,a,l,c,d,u,y,m,f,h,b,p,g,x,A,S,k,C,w,E,v,F){"use strict";const R="oj-cardgrid-item",K="."+R;const T=e=>({animationStates:{slideUp:{from:{translateY:"50px"},to:{translateY:"0px"},options:{duration:300,delay:50*e,easing:[0,0,.2,1]}},slideDown:{from:{translateY:"-50px"},to:{translateY:"0"},options:{duration:300,delay:50*e,easing:[0,0,.2,1]}}},isAnimatedOnMount:!0}),M=e=>({animationStates:{opacity:{from:{opacity:0},to:{opacity:1},options:{duration:150,delay:50*e,easing:"linear"}}},isAnimatedOnMount:!0}),N=b.memo((function({children:e,itemKey:o,itemIndex:n,isTabbable:s,isFocused:a,isFocusRingVisible:l,isSelected:c,selectionMode:d,initialAnimation:u,setCardDimension:y}){const m=i.useRef(null),f=k.multiVariantStyles({itemFocused:a&&l?"isItemFocused":"isNotItemFocused",itemInitialOpacity:u?"isTransparent":"isNotTransparent"}),h=C.classNames([R,k.styles.itemStyle,f]);i.useLayoutEffect((()=>{const e=m.current?.firstElementChild;y&&e&&y({width:e.offsetWidth,height:e.offsetHeight})}),[]);const{nodeRef:b}=w.useAnimation(u||"none",T(n)),{nodeRef:p}=w.useAnimation(u?"opacity":"none",M(n)),x=i.useMemo((()=>g.mergeRefs(m,b,p)),[m,b,p,u]);return t.jsx("div",{id:r.useId(),ref:x,class:h,role:"gridcell","data-oj-key":o,onKeyDown:e=>{!s||"ArrowDown"!==e.key&&"ArrowUp"!==e.key&&"ArrowLeft"!==e.key&&"ArrowRight"!==e.key||e.stopPropagation()},"aria-selected":"none"===d?void 0:c,..."number"==typeof o&&{"data-oj-key-type":"number"},children:t.jsx(A.TabbableModeContext.Provider,{value:{isTabbable:s},children:t.jsx(E.FocusTrap,{isDisabled:!s,restoreFocusRef:!1,children:e})})})}),((e,t)=>!(!e||!t)&&(e.itemKey===t.itemKey&&e.itemIndex===t.itemIndex&&e.itemData===t.itemData&&e.isTabbable===t.isTabbable&&e.isFocused===t.isFocused&&e.isFocusRingVisible===t.isFocusRingVisible&&e.isSelected===t.isSelected&&e.initialAnimation===t.initialAnimation)));const I={all:!1,keys:new Set},P={xs:12,sm:16,md:24,lg:48,xl:64},_=260,j=(e,i,o)=>[...Array(e)].map((()=>t.jsx(f.SkeletonContainer,{minimumCount:1,children:()=>t.jsx(F.Skeleton,{height:`calc(${o||300}px)`})},i&&r.useId()+(new Date).getTime()))),U=e=>t.jsx(u.Grid,{...e,children:j(25)}),D=(e,i,o,n)=>{if(!o)return;const s={...e};o&&!i&&(s.gridTemplateColumns=`repeat(auto-fit, ${_}px)`);const r=[],a=[],l=o-i%o;if(l>0){const e=j(l,!0,n);r.push(e),a.push(l)}const c=o;if(l<c){const e=j(c,!0,n);r.push(e),a.push(c)}return r.map(((e,i)=>t.jsx("div",{...0==i&&{class:v.LOADMORE_STYLE_CLASS},style:{gridColumn:`span ${a[i]}`},children:t.jsx(u.Grid,{...s,children:e})})))},V=(e,t,i)=>{if(!t||!i)return 0;return Math.floor((i+e)/(e+t))};e.CardGrid=function({children:e,data:r,onLoadMore:m=(()=>{}),hasMore:f=!1,getRowKey:h,currentKey:b,onCurrentKeyChange:p,selectionMode:g="none",selectedKeys:x=I,onSelectionChange:A,viewportConfig:S,"aria-label":C,"aria-labelledby":w,initialAnimation:E="slideUp",gutterSize:F="sm"}){const R=i.useRef(null),T=i.useRef(),M=i.useRef(),j=i.useRef(!0),[L,B]=i.useState(0),[G,O]=i.useState({width:0,height:0}),Y=P[F],$={gap:Y/4+"x",gridTemplateColumns:G.width?`repeat(auto-fit, ${G.width}px)`:void 0},z="none"===g?void 0:"multiple"===g,W=f||!r||0===L?-1:Math.ceil(r?.length/L);i.useEffect((()=>{G.width&&L&&(j.current=!1)}),[G.width&&L]);const H=i.useCallback((e=>{const t=V(Y,G.width||_,e);t>0&&B(t)}),[Y,G.width]);i.useEffect((()=>{const e=R?.current;e&&H(e.offsetWidth)}),[H]);const q=i.useCallback((e=>{for(const t of e)H(t.contentRect.width)}),[H]);i.useEffect((()=>{const e=R.current;if(e){const t=new ResizeObserver((e=>{q(e)}));return t.observe(e),()=>{t.unobserve(e)}}}),[q]);const J=e=>!!R.current?.contains(e);let Q=!1;const[X,Z]=c.useTabbableModeSet(J,(e=>s.keyExtractor(e,K)),b,((e,t)=>{J(e)&&(t?(Q=!0,setTimeout((()=>{R.current?.focus()}),0)):R.current?.focus())}),(e=>{p&&p({value:e})})),{currentKeyProps:ee}=a.useCurrentKey((e=>s.keyExtractor(e,K)),"multiple"!==g,(()=>s.getPrevNextKeyByCount(r,h,b,-L)),(()=>s.getPrevNextKeyByCount(r,h,b,L)),(()=>s.getPrevNextKeyByCount(r,h,b,-1)),(()=>s.getPrevNextKeyByCount(r,h,b,1)),b,p),[te,ie]=l.useCollectionFocusRing(J,["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"]);i.useEffect((()=>{if(null!=b&&R.current){const e=s.findElementByKey(R.current,b,K);if(e){e.scrollIntoView({block:"nearest"});const t=e.closest("[role=gridcell]");t&&R.current.setAttribute("aria-activedescendant",t.id)}}}),[b,r]);const oe=i.useCallback((e=>{A&&(!1===e.value.all&&e.value.keys.size>0&&(T.current=Array.from(e.value.keys.values()).pop()),A(e))}),[T,A]),ne=i.useCallback((e=>{if(r&&A){const t=s.handleSelectionRange(e,r,h);Array.isArray(t)&&A({value:{all:!1,keys:new Set(t)},target:null})}}),[r,A,m]),{selectionProps:se}=d.useSelection((e=>e===R.current?void 0===b?null:b:s.keyExtractor(e,K)),x,g,!1,"replace",!1,oe,T.current,b,((e,t)=>()=>s.getPrevNextKeyByCount(r,h,e,t?-L:L)),((e,t)=>()=>s.getPrevNextKeyByCount(r,h,e,t?-1:1)),(e=>{if(R.current){const t=s.findElementByKey(R.current,e,K);t&&t.scrollIntoView({block:"nearest"})}}),ne),re=i.useCallback((e=>{const i=h(e.data),o="multiple"===g?()=>t.jsx(y.Selector,{onChange:A,rowKey:i,selectedKeys:x}):void 0;return{index:e.index,data:e.data,metadata:{key:i},selector:o,isSelected:n.containsKey(x,i)}}),[g,x,A]),ae=D($,r?.length||0,L,G.height);S=s.getViewportConfig(R,S);const le=t.jsx("div",{role:"row",children:t.jsx(u.Grid,{...$,children:t.jsx(v.LoadMoreCollection,{data:r,hasMore:f,onLoadMore:m,loadMoreIndicator:ae,loadMoreThreshold:Y+4,viewportConfig:S,children:i=>{const o=re(i),n=X(o.metadata.key),s=b===o.metadata.key&&!n,r=s&&te&&!Q,a=o.isSelected;return(i=>t.jsx(N,{itemKey:o.metadata.key,itemIndex:o.index,itemData:o.data,isTabbable:n,isFocused:s,isFocusRingVisible:r,isSelected:a,selectionMode:g,...j.current&&{initialAnimation:E},...0===i.index&&{setCardDimension:O},children:e(i)},o.metadata.key))(o)}})})});return t.jsx("div",{...o.mergeProps(Z,ee,ie,se,{onFocus:()=>{if(!n.isKeyDefined(b)&&p&&X(void 0)&&R.current){const e=M.current||s.getFirstVisibleKey(R.current,K);n.isKeyDefined(e)&&p({value:e})}},onPointerDown:e=>{const t=s.keyExtractor(e.target,K);n.isKeyDefined(t)&&(M.current=t)}}),ref:R,role:"grid",class:k.styles.baseStyle,tabIndex:0,"aria-label":C,"aria-labelledby":w,"aria-multiselectable":z,"aria-rowcount":W,"aria-colcount":L,children:null==r?U($):le})}}));
//# sourceMappingURL=CardGrid-9b307c00.js.map
